<!--pages/statistics/statistics.wxml-->
<view class="page-container">
  <!-- æ¨¡å¼åˆ‡æ¢æ  -->
  <view class="team-switch-bar" wx:if="{{userMode && isLogin}}">
    <view class="team-info">
      <text class="team-label">å½“å‰æ¨¡å¼ï¼š</text>
      <text class="team-name">{{userMode === 'personal' ? 'ä¸ªäººæ¨¡å¼' : 'å›¢é˜Ÿæ¨¡å¼'}}</text>
    </view>
    <view class="switch-btn" bindtap="switchMode">
      <text>åˆ‡æ¢</text>
    </view>
  </view>

  <!-- æ¸¸å®¢æ¨¡å¼æç¤º -->
  <view wx:if="{{!isLogin}}" class="guest-tip">
    <text class="tip-text">ğŸ¯ æ‚¨æ­£åœ¨ä»¥æ¸¸å®¢èº«ä»½æµè§ˆç¤ºä¾‹æ•°æ®</text>
    <text class="tip-subtitle">ç™»å½•åå¯æŸ¥çœ‹æ‚¨çš„çœŸå®ç»Ÿè®¡æ•°æ®</text>
  </view>

  <!-- æ¦‚è§ˆç»Ÿè®¡ -->
  <view class="overview-section">
    <view class="section-title">
      <text class="title-text">æ•°æ®æ¦‚è§ˆ</text>
      <text class="title-subtitle">{{currentMonth}}æœˆç»Ÿè®¡</text>
    </view>
    
    <view class="overview-grid">
      <view class="overview-card">
        <view class="card-icon">ğŸ¦œ</view>
        <view class="card-content">
          <text class="card-number">{{overview.total_parrots || 0}}</text>
          <text class="card-label">é¹¦é¹‰æ€»æ•°</text>
        </view>
      </view>
      
      <view class="overview-card">
        <view class="card-icon">ğŸ</view>
        <view class="card-content">
          <text class="card-number">{{overview.monthly_feeding || 0}}</text>
          <text class="card-label">æœ¬æœˆå–‚é£Ÿ</text>
        </view>
      </view>
      
      <view class="overview-card">
        <view class="card-icon">ğŸ¥</view>
        <view class="card-content">
          <text class="card-number">{{overview.monthly_health_checks || 0}}</text>
          <text class="card-label">å¥åº·æ£€æŸ¥</text>
        </view>
      </view>
      
      <view class="overview-card">
        <view class="card-icon">ğŸ’°</view>
        <view class="card-content">
          <text class="card-number">Â¥{{overview.monthly_expense || 0}}</text>
          <text class="card-label">æœ¬æœˆæ”¯å‡º</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¥åº·çŠ¶æ€åˆ†å¸ƒ -->
  <view class="health-section">
    <view class="card">
      <view class="card-header">
        <text class="card-title">å¥åº·çŠ¶æ€åˆ†å¸ƒ</text>
      </view>
      <view class="card-content">
        <view class="health-stats">
          <view class="health-item">
            <view class="health-indicator healthy"></view>
            <text class="health-label">å¥åº·</text>
            <text class="health-count">{{overview.health_status.healthy || 0}}</text>
          </view>
          <view class="health-item">
            <view class="health-indicator sick"></view>
            <text class="health-label">ç”Ÿç—…</text>
            <text class="health-count">{{overview.health_status.sick || 0}}</text>
          </view>
          <view class="health-item">
            <view class="health-indicator recovering"></view>
            <text class="health-label">åº·å¤ä¸­</text>
            <text class="health-count">{{overview.health_status.recovering || 0}}</text>
          </view>
          <view class="health-item">
            <view class="health-indicator observation"></view>
            <text class="health-label">è§‚å¯Ÿä¸­</text>
            <text class="health-count">{{overview.health_status.observation || 0}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å–‚é£Ÿè¶‹åŠ¿ -->
  <view class="feeding-trends-section">
    <view class="card">
      <view class="card-header">
        <text class="card-title">å–‚é£Ÿè¶‹åŠ¿</text>
        <view class="time-filter">
          <text class="filter-btn {{feedingPeriod === 'week' ? 'active' : ''}}" bindtap="changeFeedingPeriod" data-period="week">7å¤©</text>
          <text class="filter-btn {{feedingPeriod === 'month' ? 'active' : ''}}" bindtap="changeFeedingPeriod" data-period="month">30å¤©</text>
        </view>
      </view>
      <view class="card-content">
        <view class="chart-container">
          <view class="chart-placeholder" wx:if="{{feedingTrends.length === 0}}">
            <text class="placeholder-text">æš‚æ— æ•°æ®</text>
          </view>
          <view class="trend-chart" wx:else>
            <view class="chart-item" wx:for="{{feedingTrends}}" wx:key="date">
              <view class="chart-bar">
                <view class="bar-fill" style="height: {{item.percentage}}%"></view>
              </view>
              <text class="chart-label">{{item.date_short}}</text>
              <text class="chart-value">{{item.count}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ”¯å‡ºåˆ†æ -->
  <view class="expense-section">
    <view class="card">
      <view class="card-header">
        <text class="card-title">æ”¯å‡ºåˆ†æ</text>
      </view>
      <view class="card-content">
        <view class="expense-list" wx:if="{{expenseAnalysis.length > 0}}">
          <view class="expense-item" wx:for="{{expenseAnalysis}}" wx:key="category">
            <view class="expense-info">
              <text class="expense-category">{{item.category}}</text>
              <text class="expense-amount">Â¥{{item.amount}}</text>
            </view>
            <view class="expense-bar">
              <view class="expense-fill" style="width: {{item.percentage}}%"></view>
            </view>
            <text class="expense-percentage">{{item.percentage}}%</text>
          </view>
        </view>
        <view class="empty-placeholder" wx:else>
          <text class="placeholder-text">æš‚æ— æ”¯å‡ºè®°å½•</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æŠ¤ç†é¢‘ç‡ -->
  <view class="care-frequency-section">
    <view class="card">
      <view class="card-header">
        <text class="card-title">æŠ¤ç†é¢‘ç‡ç»Ÿè®¡</text>
        <text class="card-subtitle">æœ€è¿‘30å¤©</text>
      </view>
      <view class="card-content">
        <view class="frequency-grid">
          <view class="frequency-item">
            <view class="frequency-icon">ğŸ</view>
            <view class="frequency-info">
              <text class="frequency-label">å¹³å‡å–‚é£Ÿ</text>
              <text class="frequency-value">{{careFrequency.avg_feeding_per_day || 0}}æ¬¡/å¤©</text>
            </view>
          </view>
          
          <view class="frequency-item">
            <view class="frequency-icon">ğŸ§½</view>
            <view class="frequency-info">
              <text class="frequency-label">æ¸…æ´é¢‘ç‡</text>
              <text class="frequency-value">{{careFrequency.avg_cleaning_per_week || 0}}æ¬¡/å‘¨</text>
            </view>
          </view>
          
          <view class="frequency-item">
            <view class="frequency-icon">ğŸ¥</view>
            <view class="frequency-info">
              <text class="frequency-label">å¥åº·æ£€æŸ¥</text>
              <text class="frequency-value">{{careFrequency.avg_health_check_per_month || 0}}æ¬¡/æœˆ</text>
            </view>
          </view>
          
          <view class="frequency-item">
            <view class="frequency-icon">ğŸ“Š</view>
            <view class="frequency-info">
              <text class="frequency-label">è®°å½•å®Œæ•´åº¦</text>
              <text class="frequency-value">{{careFrequency.record_completeness || 0}}%</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å“ç§åˆ†å¸ƒ -->
  <view class="species-section">
    <view class="card">
      <view class="card-header">
        <text class="card-title">å“ç§åˆ†å¸ƒ</text>
      </view>
      <view class="card-content">
        <view class="species-list" wx:if="{{speciesDistribution.length > 0}}">
          <view class="species-item" wx:for="{{speciesDistribution}}" wx:key="species">
            <view class="species-info">
              <text class="species-name">{{item.species}}</text>
              <text class="species-count">{{item.count}}åª</text>
            </view>
            <view class="species-bar">
              <view class="species-fill" style="width: {{item.percentage}}%"></view>
            </view>
          </view>
        </view>
        <view class="empty-placeholder" wx:else>
          <text class="placeholder-text">æš‚æ— æ•°æ®</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>