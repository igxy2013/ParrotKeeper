<view class="page-container">
  <app-header title="鹦鹉品种管理" subtitle="维护品种基础信息" showBack="true">
    <view slot="actions" class="header-btn" bindtap="openCreateModal">
      <image class="header-btn-icon-img" src="/images/remix/add-circle-fill.png" mode="widthFix" />
    </view>
  </app-header>
  <view class="page-content">
    <block wx:if="{{!isSuperAdmin}}"><view class="no-access">仅超级管理员可访问</view></block>
    <block wx:elif="{{loading}}"><view class="loading">加载中...</view></block>
    <block wx:else>
      

      <view class="list" wx:if="{{speciesList && speciesList.length}}">
        <view class="item" wx:for="{{speciesList}}" wx:key="id">
          <view class="item-header">
            <text class="name">{{item.name}}</text>
            <view class="actions">
              <view class="action-btn edit-btn" catchtap="openEditModal" data-id="{{item.id}}">
                <image class="action-icon-img" src="/images/remix/edit-line-white.png" mode="aspectFit" />
              </view>
              <view class="action-btn delete-btn" catchtap="deleteSpecies" data-id="{{item.id}}">
                <image class="action-icon-img" src="/images/remix/delete-bin-line-white.png" mode="aspectFit" />
              </view>
            </view>
          </view>
          <view class="item-body">
            <view class="kv-row" wx:if="{{item.description}}">
              <text class="kv-label">说明</text>
              <text class="kv-value">{{item.description}}</text>
            </view>
            <view class="kv-row">
              <text class="kv-label">羽色</text>
              <text class="kv-value">{{item.plumage_summary || '未配置'}}</text>
            </view>
            <view class="kv-row" wx:if="{{item.lifespan_range}}">
              <text class="kv-label">寿命区间</text>
              <text class="kv-value">{{item.lifespan_range}}</text>
            </view>
            <view class="kv-row" wx:if="{{item.size_range}}">
              <text class="kv-label">体型区间</text>
              <text class="kv-value">{{item.size_range}}</text>
            </view>
            <view class="kv-row" wx:if="{{item.weight_range}}">
              <text class="kv-label">体重区间</text>
              <text class="kv-value">{{item.weight_range}}</text>
            </view>
            <view class="badge-group">
              <text class="badge difficulty {{item.care_level}}">养护难度：{{item.care_level === 'easy' ? '容易' : item.care_level === 'hard' ? '困难' : '一般'}}</text>
            </view>
          </view>
        </view>
      </view>
      <view wx:else class="empty">暂无品种</view>
    </block>

    <view wx:if="{{showModal}}" class="modal-overlay" catchtouchmove="true"></view>
    <view wx:if="{{showModal}}" class="modal-content">
      <view class="modal-header-gradient">
        <view class="modal-header-row">
          <text class="modal-title">{{modalTitle}}</text>
          <view class="modal-close-btn" bindtap="closeModal"><text class="modal-close-text">×</text></view>
        </view>
      </view>
      <scroll-view scroll-y="true" class="modal-scroll">
        <view class="form-section">
          <view class="form-item">
            <text class="form-label">品种名称 *</text>
            <input class="text-input" placeholder="请输入品种名称" value="{{form.name}}" bindinput="onFormInput" data-field="name" />
          </view>
          <view class="form-item">
            <text class="form-label">说明</text>
            <input class="text-input" placeholder="可选" value="{{form.description}}" bindinput="onFormInput" data-field="description" />
          </view>
          <view class="form-item">
            <text class="form-label">寿命区间(年)</text>
            <view class="range-row">
              <input class="range-input" type="number" placeholder="最小" value="{{form.avg_lifespan_min}}" bindinput="onFormInput" data-field="avg_lifespan_min" />
              <text class="range-sep">—</text>
              <input class="range-input" type="number" placeholder="最大" value="{{form.avg_lifespan_max}}" bindinput="onFormInput" data-field="avg_lifespan_max" />
            </view>
          </view>
          <view class="form-item">
            <text class="form-label">体型区间(cm)</text>
            <view class="range-row">
              <input class="range-input" type="number" placeholder="最小" value="{{form.avg_size_min_cm}}" bindinput="onFormInput" data-field="avg_size_min_cm" />
              <text class="range-sep">—</text>
              <input class="range-input" type="number" placeholder="最大" value="{{form.avg_size_max_cm}}" bindinput="onFormInput" data-field="avg_size_max_cm" />
            </view>
          </view>
          <view class="form-item">
            <text class="form-label">参考体重(g)</text>
            <input class="text-input" type="number" placeholder="平均值" value="{{form.reference_weight_g}}" bindinput="onFormInput" data-field="reference_weight_g" />
          </view>
          <view class="form-item">
            <text class="form-label">体重区间(g)</text>
            <view class="range-row">
              <input class="range-input" type="number" placeholder="最小" value="{{form.reference_weight_min_g}}" bindinput="onFormInput" data-field="reference_weight_min_g" />
              <text class="range-sep">—</text>
              <input class="range-input" type="number" placeholder="最大" value="{{form.reference_weight_max_g}}" bindinput="onFormInput" data-field="reference_weight_max_g" />
            </view>
          </view>
          <view class="form-item">
            <text class="form-label">养护难度</text>
            <picker range="{{careLevels}}" value="{{careLevelIndex}}" bindchange="onCareLevelChange">
              <view class="picker-display">
                <text>{{careLevels[careLevelIndex] || '选择养护难度'}}</text>
              </view>
            </picker>
          </view>
        </view>
      </scroll-view>
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="closeModal">取消</button>
        <button class="btn-primary" bindtap="submitForm">保存</button>
      </view>
    </view>
  </view>
</view>
