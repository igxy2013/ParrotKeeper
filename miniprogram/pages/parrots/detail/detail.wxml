<!--pages/parrots/detail/detail.wxml-->
<view class="page-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é¹¦é¹‰è¯¦æƒ… -->
  <view class="detail-content" wx:else>
    <!-- å¤´éƒ¨ä¿¡æ¯å¡ç‰‡ -->
    <view class="header-card">
      <view class="parrot-avatar-section">
        <view class="avatar-container">
          <image 
            class="parrot-avatar" 
            src="{{parrot.avatar_url || parrot.photo_url || '/images/default-parrot.svg'}}" 
            mode="aspectFill"
            bindtap="previewPhoto"
          />
          <view class="status-overlay">
            <view class="health-badge status-{{parrot.health_status}}">
              {{healthStatusText}}
            </view>
          </view>
        </view>
        
        <view class="parrot-info">
          <view class="parrot-name">{{parrot.name}}</view>
          <view class="parrot-species">{{parrot.species_name}}</view>
          <view class="parrot-meta">
            <view class="gender-info">
              <text class="gender-icon">{{parrot.gender === 'male' ? 'â™‚' : parrot.gender === 'female' ? 'â™€' : 'ï¼Ÿ'}}</text>
              <text class="gender-text">{{parrot.gender === 'male' ? 'é›„æ€§' : parrot.gender === 'female' ? 'é›Œæ€§' : 'æœªçŸ¥'}}</text>
            </view>
            <view class="age-info" wx:if="{{age}}">
              <text class="age-text">{{age}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- è¯¦ç»†ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-cards">
      <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
      <view class="info-card">
        <view class="card-header">
          <text class="card-title">åŸºæœ¬ä¿¡æ¯</text>
          <text class="card-icon">ğŸ“‹</text>
        </view>
        <view class="card-content">
          <view class="info-row">
            <text class="info-label">é¹¦é¹‰åç§°</text>
            <text class="info-value">{{parrot.name}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">å“ç§</text>
            <text class="info-value">{{parrot.species ? parrot.species.name : 'æœªè®¾ç½®'}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æ€§åˆ«</text>
            <text class="info-value">{{parrot.gender === 'male' ? 'é›„æ€§ â™‚' : parrot.gender === 'female' ? 'é›Œæ€§ â™€' : 'æœªçŸ¥ ï¼Ÿ'}}</text>
          </view>
          <view class="info-row" wx:if="{{parrot.birth_date}}">
            <text class="info-label">å‡ºç”Ÿæ—¥æœŸ</text>
            <text class="info-value">{{parrot.birth_date}} ({{age}})</text>
          </view>
          <view class="info-row" wx:if="{{parrot.acquisition_date}}">
            <text class="info-label">å…¥ä½æ—¥æœŸ</text>
            <text class="info-value">{{parrot.acquisition_date}} ({{daysWithUs}}å¤©)</text>
          </view>
        </view>
      </view>

      <!-- æ¡£æ¡ˆä¿¡æ¯å¡ç‰‡ -->
      <view class="info-card" wx:if="{{parrot.parrot_number || parrot.ring_number}}">
        <view class="card-header">
          <text class="card-title">æ¡£æ¡ˆä¿¡æ¯</text>
          <text class="card-icon">ğŸ·ï¸</text>
        </view>
        <view class="card-content">
          <view class="info-row" wx:if="{{parrot.parrot_number}}">
            <text class="info-label">ç¼–å·</text>
            <text class="info-value">{{parrot.parrot_number}}</text>
          </view>
          <view class="info-row" wx:if="{{parrot.ring_number}}">
            <text class="info-label">è„šç¯å·</text>
            <text class="info-value">{{parrot.ring_number}}</text>
          </view>
        </view>
      </view>

      <!-- å¥åº·ä¿¡æ¯å¡ç‰‡ -->
      <view class="info-card">
        <view class="card-header">
          <text class="card-title">å¥åº·ä¿¡æ¯</text>
          <text class="card-icon">ğŸ¥</text>
        </view>
        <view class="card-content">
          <view class="info-row" wx:if="{{parrot.weight}}">
            <text class="info-label">ä½“é‡</text>
            <text class="info-value">{{parrot.weight}}g</text>
          </view>
          <view class="info-row">
            <text class="info-label">å¥åº·çŠ¶æ€</text>
            <view class="health-status-display">
              <view class="status-dot status-{{parrot.health_status}}"></view>
              <text class="status-text">{{healthStatusText}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- é¹¦é¹‰ç…§ç‰‡ -->
      <view class="info-section" wx:if="{{parrot.photo_url}}">
        <view class="section-title">é¹¦é¹‰ç…§ç‰‡</view>
        <view class="photo-display">
          <image 
            class="detail-photo" 
            src="{{parrot.photo_url}}" 
            mode="aspectFill"
            bindtap="previewPhoto"
          />
        </view>
      </view>

      <!-- å¤‡æ³¨ä¿¡æ¯ -->
      <view class="info-section" wx:if="{{parrot.notes}}">
        <view class="section-title">å¤‡æ³¨ä¿¡æ¯</view>
        <view class="info-list">
          <view class="info-item">
            <text class="info-label">å¤‡æ³¨</text>
            <text class="info-value">{{parrot.notes}}</text>
          </view>
        </view>
      </view>

      <!-- æŠ¤ç†ç»Ÿè®¡å¡ç‰‡ -->
      <view class="info-card" wx:if="{{statistics}}">
        <view class="card-header">
          <text class="card-title">æŠ¤ç†ç»Ÿè®¡</text>
          <text class="card-icon">ğŸ“Š</text>
        </view>
        <view class="card-content">
          <view class="stats-grid">
            <view class="stat-card">
              <view class="stat-number">{{statistics.total_feeding || 0}}</view>
              <view class="stat-label">æ€»å–‚é£Ÿæ¬¡æ•°</view>
              <view class="stat-icon">ğŸ½ï¸</view>
            </view>
            <view class="stat-card">
              <view class="stat-number">{{statistics.total_cleaning || 0}}</view>
              <view class="stat-label">æ€»æ¸…æ´æ¬¡æ•°</view>
              <view class="stat-icon">ğŸ§¹</view>
            </view>
            <view class="stat-card">
              <view class="stat-number">{{statistics.total_health_check || 0}}</view>
              <view class="stat-label">å¥åº·æ£€æŸ¥</view>
              <view class="stat-icon">ğŸ¥</view>
            </view>
            <view class="stat-card">
              <view class="stat-number">{{statistics.days_since_last_feeding || 0}}</view>
              <view class="stat-label">è·ä¸Šæ¬¡å–‚é£Ÿ</view>
              <view class="stat-icon">â°</view>
            </view>
          </view>
        </view>
      </view>

      <!-- æœ€è¿‘è®°å½•å¡ç‰‡ -->
      <view class="info-card" wx:if="{{recentRecords.length > 0}}">
        <view class="card-header">
          <text class="card-title">æœ€è¿‘è®°å½•</text>
          <text class="view-all-btn" bindtap="viewAllRecords">æŸ¥çœ‹å…¨éƒ¨</text>
        </view>
        <view class="card-content">
          <view class="records-timeline">
            <view 
              class="record-timeline-item" 
              wx:for="{{recentRecords}}" 
              wx:key="id"
            >
              <view class="timeline-dot type-{{item.type}}">
                <text class="timeline-icon">{{typeIcons[item.type]}}</text>
              </view>
              <view class="timeline-content">
                <view class="record-header">
                  <text class="record-title">{{typeNames[item.type]}}</text>
                  <text class="record-time">{{item.created_at}}</text>
                </view>
                <view class="record-notes" wx:if="{{item.notes}}">{{item.notes}}</view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¿«é€Ÿæ“ä½œå¡ç‰‡ -->
    <view class="quick-actions-card">
      <view class="card-header">
        <text class="card-title">å¿«é€Ÿæ“ä½œ</text>
        <text class="card-icon">âš¡</text>
      </view>
      <view class="card-content">
        <view class="quick-actions-grid">
          <button class="quick-action-btn feeding" bindtap="quickFeeding" wx:if="{{hasOperationPermission}}">
            <view class="action-icon">ğŸ½ï¸</view>
            <text class="action-text">å¿«é€Ÿå–‚é£Ÿ</text>
          </button>
          <button class="quick-action-btn cleaning" bindtap="quickCleaning" wx:if="{{hasOperationPermission}}">
            <view class="action-icon">ğŸ§¹</view>
            <text class="action-text">å¿«é€Ÿæ¸…æ´</text>
          </button>
          <button class="quick-action-btn health" bindtap="quickHealthCheck" wx:if="{{hasOperationPermission}}">
            <view class="action-icon">ğŸ¥</view>
            <text class="action-text">å¥åº·æ£€æŸ¥</text>
          </button>
          <button class="quick-action-btn records" bindtap="viewRecords">
            <view class="action-icon">ğŸ“‹</view>
            <text class="action-text">æŸ¥çœ‹è®°å½•</text>
          </button>
        </view>
      </view>
    </view>

    <!-- ç®¡ç†æ“ä½œå¡ç‰‡ -->
    <view class="manage-actions-card" wx:if="{{hasOperationPermission}}">
      <view class="card-header">
        <text class="card-title">ç®¡ç†æ“ä½œ</text>
        <text class="card-icon">âš™ï¸</text>
      </view>
      <view class="card-content">
        <view class="manage-actions-list">
          <button class="manage-action-btn edit" bindtap="editParrot">
            <view class="manage-icon">âœï¸</view>
            <view class="manage-content">
              <text class="manage-title">ç¼–è¾‘ä¿¡æ¯</text>
              <text class="manage-desc">ä¿®æ”¹é¹¦é¹‰åŸºæœ¬ä¿¡æ¯</text>
            </view>
            <view class="manage-arrow">â€º</view>
          </button>
          <button class="manage-action-btn delete" bindtap="deleteParrot">
            <view class="manage-icon danger">ğŸ—‘ï¸</view>
            <view class="manage-content">
              <text class="manage-title danger">åˆ é™¤é¹¦é¹‰</text>
              <text class="manage-desc">æ°¸ä¹…åˆ é™¤æ­¤é¹¦é¹‰ä¿¡æ¯</text>
            </view>
            <view class="manage-arrow">â€º</view>
          </button>
        </view>
      </view>
    </view>
  </view>
</view>