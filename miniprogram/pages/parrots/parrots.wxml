<!--pages/parrots/parrots.wxml-->
<view class="page-container">
  <!-- æ¨¡å¼åˆ‡æ¢æ  -->
  <view class="team-switch-bar" wx:if="{{userMode}}">
    <view class="team-info">
      <text class="team-label">å½“å‰æ¨¡å¼ï¼š</text>
      <text class="team-name">{{userMode === 'personal' ? 'ä¸ªäººæ¨¡å¼' : 'å›¢é˜Ÿæ¨¡å¼'}}</text>
    </view>
    <view class="switch-btn" bindtap="switchMode">
      <text>åˆ‡æ¢</text>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰ -->
  <view class="search-section">
    <view class="search-bar">
      <input 
        class="search-input" 
        placeholder="æœç´¢é¹¦é¹‰åç§°ã€ç¼–å·æˆ–è„šç¯å·..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <view class="search-btn" bindtap="onSearch">
        <text class="icon">ğŸ”</text>
      </view>
    </view>
    
    <view class="filter-bar">
      <view class="filter-item" bindtap="showSpeciesFilter">
        <text class="filter-text">{{selectedSpecies ? selectedSpecies : 'å“ç§'}}</text>
        <text class="filter-arrow">â–¼</text>
      </view>
      <view class="filter-item" bindtap="showStatusFilter">
        <text class="filter-text">{{selectedStatus ? selectedStatus : 'çŠ¶æ€'}}</text>
        <text class="filter-arrow">â–¼</text>
      </view>
      <view class="filter-item" bindtap="showSortFilter">
        <text class="filter-text">{{sortText}}</text>
        <text class="filter-arrow">â–¼</text>
      </view>
    </view>
  </view>

  <!-- é¹¦é¹‰åˆ—è¡¨ -->
  <view class="parrot-list" wx:if="{{parrots.length > 0}}">
    <view class="parrot-card" wx:for="{{parrots}}" wx:key="id" bindtap="viewParrotDetail" data-id="{{item.id}}">
      <view class="parrot-main">
        <!-- é¹¦é¹‰å¤´åƒå’ŒçŠ¶æ€ -->
        <view class="parrot-avatar">
          <image 
            class="parrot-image" 
            src="{{item.photo_url || item.avatar_url || '/images/default-parrot.svg'}}" 
            mode="aspectFill"
            binderror="handleImageError"
            data-id="{{item.id}}"
          />
          <view class="status-badge status-{{item.health_status}}">
            <text wx:if="{{item.health_status === 'healthy'}}">âœ“</text>
            <text wx:elif="{{item.health_status === 'sick'}}">!</text>
            <text wx:elif="{{item.health_status === 'recovering'}}">â†—</text>
            <text wx:else="{{item.health_status === 'observation'}}">ğŸ‘</text>
          </view>
        </view>
        
        <!-- åŸºæœ¬ä¿¡æ¯ -->
        <view class="parrot-info">
          <view class="name-section">
            <text class="parrot-name">{{item.name}}</text>
            <text class="parrot-gender {{item.gender}}">{{item.gender === 'male' ? 'â™‚' : item.gender === 'female' ? 'â™€' : 'ï¼Ÿ'}}</text>
          </view>
          <text class="parrot-species">{{item.species_name}}</text>
          <view class="info-tags">
            <text class="info-tag">{{item.age_days}}å¤©</text>
            <text class="info-tag" wx:if="{{item.weight}}">{{item.weight}}g</text>
            <text class="info-tag status-tag status-{{item.health_status}}">
              <text wx:if="{{item.health_status === 'healthy'}}">å¥åº·</text>
              <text wx:elif="{{item.health_status === 'sick'}}">ç”Ÿç—…</text>
              <text wx:elif="{{item.health_status === 'recovering'}}">åº·å¤ä¸­</text>
              <text wx:else="{{item.health_status === 'observation'}}">è§‚å¯Ÿä¸­</text>
            </text>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="parrot-actions">
          <view class="action-btn edit" bindtap="editParrot" data-id="{{item.id}}">
            <text class="action-icon">âœï¸</text>
          </view>
        </view>
      </view>
      
      <!-- å¤‡æ³¨ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰ -->
      <view class="parrot-notes" wx:if="{{item.notes}}">
        <text class="notes-text">{{item.notes}}</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{parrots.length === 0 && !loading}}">
    <view class="empty-icon">ğŸ¦œ</view>
    <view class="empty-text" wx:if="{{isLogin}}">è¿˜æ²¡æœ‰é¹¦é¹‰è®°å½•</view>
    <view class="empty-text" wx:else>æ¸¸å®¢æ¨¡å¼</view>
    <view class="empty-subtitle" wx:if="{{isLogin}}">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ æ‚¨çš„ç¬¬ä¸€åªé¹¦é¹‰</view>
    <view class="empty-subtitle" wx:else>ç™»å½•åå¯ä»¥ç®¡ç†æ‚¨çš„é¹¦é¹‰æ¡£æ¡ˆ</view>
    <button class="btn btn-primary btn-large mt-30" wx:if="{{isLogin}}" bindtap="addParrot">æ·»åŠ é¹¦é¹‰</button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="fab" wx:if="{{isLogin}}" bindtap="addParrot">
    <text class="fab-icon">+</text>
  </view>
</view>

<!-- å“ç§ç­›é€‰å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showSpeciesModal}}" bindtap="hideSpeciesFilter">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©å“ç§</text>
      <view class="modal-close" bindtap="hideSpeciesFilter">Ã—</view>
    </view>
    <view class="modal-body">
      <view class="filter-option" bindtap="selectSpecies" data-species="">
        <text class="option-text">å…¨éƒ¨å“ç§</text>
      </view>
      <view class="filter-option" wx:for="{{speciesList}}" wx:key="id" bindtap="selectSpecies" data-species="{{item.name}}">
        <text class="option-text">{{item.name}}</text>
      </view>
    </view>
  </view>
</view>

<!-- çŠ¶æ€ç­›é€‰å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showStatusModal}}" bindtap="hideStatusFilter">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©çŠ¶æ€</text>
      <view class="modal-close" bindtap="hideStatusFilter">Ã—</view>
    </view>
    <view class="modal-body">
      <view class="filter-option" bindtap="selectStatus" data-status="">
        <text class="option-text">å…¨éƒ¨çŠ¶æ€</text>
      </view>
      <view class="filter-option" bindtap="selectStatus" data-status="healthy">
        <text class="option-text">å¥åº·</text>
      </view>
      <view class="filter-option" bindtap="selectStatus" data-status="sick">
        <text class="option-text">ç”Ÿç—…</text>
      </view>
      <view class="filter-option" bindtap="selectStatus" data-status="recovering">
        <text class="option-text">åº·å¤ä¸­</text>
      </view>
      <view class="filter-option" bindtap="selectStatus" data-status="observation">
        <text class="option-text">è§‚å¯Ÿä¸­</text>
      </view>
    </view>
  </view>
</view>

<!-- æ’åºç­›é€‰å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showSortModal}}" bindtap="hideSortFilter">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">æ’åºæ–¹å¼</text>
      <view class="modal-close" bindtap="hideSortFilter">Ã—</view>
    </view>
    <view class="modal-body">
      <view class="filter-option" bindtap="selectSort" data-sort="name_asc">
        <text class="option-text">åç§° A-Z</text>
      </view>
      <view class="filter-option" bindtap="selectSort" data-sort="name_desc">
        <text class="option-text">åç§° Z-A</text>
      </view>
      <view class="filter-option" bindtap="selectSort" data-sort="age_asc">
        <text class="option-text">å¹´é¾„ä»å°åˆ°å¤§</text>
      </view>
      <view class="filter-option" bindtap="selectSort" data-sort="age_desc">
        <text class="option-text">å¹´é¾„ä»å¤§åˆ°å°</text>
      </view>
      <view class="filter-option" bindtap="selectSort" data-sort="created_desc">
        <text class="option-text">æœ€æ–°æ·»åŠ </text>
      </view>
    </view>
  </view>
</view>