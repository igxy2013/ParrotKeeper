<view class="page-container">
  <app-header title="é£Ÿç‰©ç±»å‹ç®¡ç†" showBack="true"></app-header>
  <view class="page-content">
    <view class="feed-list">
      <block wx:for="{{feedTypes}}" wx:key="id">
        <view class="feed-item">
          <view class="feed-main">
            <view class="feed-header">
              <text class="feed-name">{{item.name}}</text>
              <text class="feed-tag" wx:if="{{!item.is_custom}}">ç³»ç»Ÿé»˜è®¤</text>
              <text class="feed-tag custom" wx:else>è‡ªå®šä¹‰</text>
            </view>
          <view class="feed-details">
            <text wx:if="{{item.brand}}">å“ç‰Œ: {{item.brand}}</text>
            <text wx:if="{{item.typeLabel}}">ç±»å‹: {{item.typeLabel}}</text>
            <text wx:if="{{item.unit}}">å•ä½: {{item.unit}}</text>
          </view>
        </view>
        <view class="feed-actions" wx:if="{{item.is_custom}}">
          <image class="action-icon" src="/images/remix/edit-line.png" mode="widthFix" bindtap="showEditModal" data-id="{{item.id}}"/>
          <image class="action-icon" src="/images/remix/delete-bin-line-red.png" mode="widthFix" bindtap="deleteFeedType" data-id="{{item.id}}"/>
        </view>
      </view>
      </block>
      <view class="empty-tip" wx:if="{{feedTypes.length === 0}}">
        <text class="empty-icon">ğŸ½ï¸</text>
        <text class="empty-text">æš‚æ— æ•°æ®</text>
      </view>
    </view>

    <view class="add-btn-wrapper">
      <button class="add-btn" bindtap="showAddModal">æ·»åŠ é£Ÿç‰©ç±»å‹</button>
    </view>
  </view>

  <!-- Add Modal -->
  <view class="modal-overlay" wx:if="{{showModal}}" bindtap="hideAddModal"></view>
  <view class="modal-content aligned" wx:if="{{showModal}}" catchtap="stopPropagation">
    <view class="modal-header-gradient">
      <view class="modal-header-row">
        <text class="modal-title">{{isEditing ? 'ç¼–è¾‘é£Ÿç‰©ç±»å‹' : 'æ·»åŠ é£Ÿç‰©ç±»å‹'}}</text>
        <view class="modal-close-btn" bindtap="hideAddModal">
          <image class="modal-close-icon-img" src="/images/remix/close-line-white.png" mode="widthFix"/>
        </view>
      </view>
    </view>
    <scroll-view scroll-y="true" class="modal-scroll">
      <view class="form-section">
        <view class="form-item">
          <text class="form-label">åç§° *</text>
          <input class="text-input" placeholder="è¯·è¾“å…¥é£Ÿç‰©åç§°" value="{{newFeed.name}}" bindinput="onInput" data-field="name" />
        </view>
        <view class="form-item">
          <text class="form-label">å“ç‰Œ</text>
          <input class="text-input" placeholder="è¯·è¾“å…¥å“ç‰Œ(é€‰å¡«)" value="{{newFeed.brand}}" bindinput="onInput" data-field="brand" />
        </view>
        <view class="form-item">
          <text class="form-label">ç±»å‹</text>
          <picker mode="selector" range="{{typeOptions}}" range-key="label" bindchange="onTypeChange">
            <view class="text-input amount-display {{selectedTypeLabel ? '' : 'placeholder'}}">
              {{selectedTypeLabel || 'è¯·é€‰æ‹©ç±»å‹'}}
            </view>
          </picker>
        </view>
        <view class="form-item">
          <text class="form-label">å•ä½</text>
          <view class="unit-switch-row">
            <view class="unit-btn unit-g {{unitSelected==='g' ? 'active' : ''}}" bindtap="setUnit" data-unit="g">g</view>
            <view class="unit-btn unit-ml {{unitSelected==='ml' ? 'active' : ''}}" bindtap="setUnit" data-unit="ml">ml</view>
          </view>
        </view>
      </view>
    </scroll-view>
    <view class="modal-footer">
      <button class="btn-secondary" bindtap="hideAddModal">å–æ¶ˆ</button>
      <button class="btn-primary" bindtap="saveFeedType">ç¡®å®š</button>
    </view>
  </view>

</view>
