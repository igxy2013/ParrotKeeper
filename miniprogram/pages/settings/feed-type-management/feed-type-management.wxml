<view class="page-container">
  <app-header title="食物类型管理" subtitle="管理食物类型与单位" showBack="{{true}}"></app-header>
  <view class="page-content">
    <view class="feed-list">
      <block wx:for="{{feedTypes}}" wx:key="id">
        <view class="feed-item">
          <view class="feed-main">
          <view class="feed-header">
            <text class="feed-name">{{item.name}}</text>
            <text class="feed-tag" wx:if="{{!item.is_custom}}">系统默认</text>
            <text class="feed-tag custom" wx:else>自定义</text>
          </view>
          <view class="feed-details">
            <text wx:if="{{item.typeLabel}}">类型: {{item.typeLabel}}</text>
            <text wx:if="{{item.unit}}">单位: {{item.unit}}</text>
          </view>
        </view>
        <view class="feed-actions" wx:if="{{item.is_custom}}">
          <image class="action-icon" src="/images/remix/edit-line.png" mode="widthFix" bindtap="showEditModal" data-id="{{item.id}}"/>
          <image class="action-icon" src="/images/remix/delete-bin-line-red.png" mode="widthFix" bindtap="deleteFeedType" data-id="{{item.id}}"/>
        </view>
      </view>
      </block>
      <view class="empty-tip" wx:if="{{feedTypes.length === 0}}">
        <text class="empty-icon">🍽️</text>
        <text class="empty-text">暂无数据</text>
      </view>
    </view>

    <view class="add-btn-wrapper">
      <button class="add-btn" bindtap="showAddModal">添加食物类型</button>
    </view>
  </view>

  <!-- Add Modal -->
  <view class="modal-overlay" wx:if="{{showModal}}" bindtap="hideAddModal"></view>
  <view class="modal-content aligned" wx:if="{{showModal}}" catchtap="stopPropagation">
    <view class="modal-header-gradient">
      <view class="modal-header-row">
        <text class="modal-title">{{isEditing ? '编辑食物类型' : '添加食物类型'}}</text>
        <view class="modal-close-btn" bindtap="hideAddModal">
          <image class="modal-close-icon-img" src="/images/remix/close-line-white.png" mode="widthFix"/>
        </view>
      </view>
    </view>
    <scroll-view scroll-y="true" class="modal-scroll">
      <view class="form-section">
        <view class="form-item">
          <text class="form-label">名称 *</text>
          <input class="text-input" placeholder="请输入食物名称" value="{{newFeed.name}}" bindinput="onInput" data-field="name" />
        </view>
        <view class="form-item">
          <text class="form-label">类型</text>
          <picker mode="selector" range="{{typeOptions}}" range-key="label" bindchange="onTypeChange">
            <view class="text-input amount-display {{selectedTypeLabel ? '' : 'placeholder'}}">
              {{selectedTypeLabel || '请选择类型'}}
            </view>
          </picker>
        </view>
        <view class="form-item">
          <text class="form-label">单位</text>
          <view class="unit-switch-row">
            <view class="unit-btn unit-g {{unitSelected==='g' ? 'active' : ''}}" bindtap="setUnit" data-unit="g">g</view>
            <view class="unit-btn unit-ml {{unitSelected==='ml' ? 'active' : ''}}" bindtap="setUnit" data-unit="ml">ml</view>
          </view>
        </view>
      </view>
    </scroll-view>
    <view class="modal-footer">
      <button class="btn-secondary" bindtap="hideAddModal">取消</button>
      <button class="btn-primary" bindtap="saveFeedType">确定</button>
    </view>
  </view>

</view>
