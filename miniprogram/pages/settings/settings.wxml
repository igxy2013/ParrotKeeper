<!--pages/settings/settings.wxml-->
<view class="page-container">
  <app-header title="设置" subtitle="个人偏好与系统设置" showBack="true">
  </app-header>
  <view class="page-content">

    <view class="section-title">
      <text class="title-icon">🔧</text>
      <text>偏好设置</text>
    </view>

    <view class="settings-actions">
      <view class="setting-action-item" bindtap="exportData">
        <view class="setting-icon-wrapper">
          <view class="setting-icon export-icon">📤</view>
        </view>
        <view class="setting-content">
          <view class="setting-name">数据导出</view>
          <view class="setting-desc">导出我的鹦鹉与记录数据</view>
        </view>
        <view class="setting-arrow">></view>
      </view>

      

      <view class="setting-action-item">
        <view class="setting-icon-wrapper">
          <view class="setting-icon notify-icon">🔔</view>
        </view>
        <view class="setting-content">
          <view class="setting-name">通知设置</view>
          <view class="setting-desc">开启推送与提醒</view>
        </view>
        <switch checked="{{notificationsEnabled}}" bindchange="toggleNotifications" />
      </view>

      <!-- 通知详细设置 -->
      <view wx:if="{{notificationsEnabled}}" class="notification-details">
        <view wx:if="{{!hasTemplateIds}}" class="setting-hint">未配置订阅模板ID，将仅支持本地提醒。</view>
        <view class="setting-action-item">
          <view class="setting-icon-wrapper">
            <view class="setting-icon">🍽️</view>
          </view>
          <view class="setting-content">
            <view class="setting-name">喂食提醒</view>
            <view class="setting-desc">定时提醒喂食时间</view>
          </view>
          <switch checked="{{feedingReminder}}" bindchange="toggleFeedingReminder" />
        </view>

        <!-- 喂食提醒时间选择器 -->
        <view class="setting-action-item">
          <view class="setting-icon-wrapper">
            <view class="setting-icon">⏰</view>
          </view>
          <view class="setting-content">
            <view class="setting-name">喂食提醒时间</view>
            <view class="setting-desc">选择每日提醒时间</view>
          </view>
          <picker mode="time" value="{{feedingReminderTime}}" bindchange="onFeedingTimeChange">
            <view class="setting-arrow">{{feedingReminderTime || '选择时间'}}</view>
          </picker>
        </view>

        <view class="setting-action-item">
          <view class="setting-icon-wrapper">
            <view class="setting-icon">🏥</view>
          </view>
          <view class="setting-content">
            <view class="setting-name">健康提醒</view>
            <view class="setting-desc">体检和健康检查提醒</view>
          </view>
          <switch checked="{{healthReminder}}" bindchange="toggleHealthReminder" />
        </view>

        <view class="setting-action-item">
          <view class="setting-icon-wrapper">
            <view class="setting-icon">🧹</view>
          </view>
          <view class="setting-content">
            <view class="setting-name">清洁提醒</view>
            <view class="setting-desc">笼子清洁和卫生提醒</view>
          </view>
          <switch checked="{{cleaningReminder}}" bindchange="toggleCleaningReminder" />
        </view>

        <!-- 清洁提醒时间选择器 -->
        <view class="setting-action-item">
          <view class="setting-icon-wrapper">
            <view class="setting-icon">⏰</view>
          </view>
          <view class="setting-content">
            <view class="setting-name">清洁提醒时间</view>
            <view class="setting-desc">选择每日提醒时间</view>
          </view>
          <picker mode="time" value="{{cleaningReminderTime}}" bindchange="onCleaningTimeChange">
            <view class="setting-arrow">{{cleaningReminderTime || '选择时间'}}</view>
          </picker>
        </view>

        <view class="setting-action-item">
          <view class="setting-icon-wrapper">
            <view class="setting-icon">💊</view>
          </view>
          <view class="setting-content">
            <view class="setting-name">用药提醒</view>
            <view class="setting-desc">药物和保健品提醒</view>
          </view>
          <switch checked="{{medicationReminder}}" bindchange="toggleMedicationReminder" />
        </view>

        <view class="setting-action-item">
          <view class="setting-icon-wrapper">
            <view class="setting-icon">🥚</view>
          </view>
          <view class="setting-content">
            <view class="setting-name">繁殖提醒</view>
            <view class="setting-desc">繁殖期和孵化提醒</view>
          </view>
          <switch checked="{{breedingReminder}}" bindchange="toggleBreedingReminder" />
        </view>

        <!-- 订阅权限与测试 -->
        <view class="setting-action-item" bindtap="reapplySubscriptionPermissions">
          <view class="setting-icon-wrapper">
            <view class="setting-icon">🔑</view>
          </view>
          <view class="setting-content">
            <view class="setting-name">订阅权限</view>
            <view class="setting-desc">重新申请模板消息权限</view>
          </view>
          <view class="setting-arrow">></view>
        </view>
        <view class="setting-action-item" bindtap="sendTestNotification">
          <view class="setting-icon-wrapper">
            <view class="setting-icon test-icon">🧪</view>
          </view>
          <view class="setting-content">
            <view class="setting-name">测试通知</view>
            <view class="setting-desc">发送一条测试订阅消息</view>
          </view>
          <view class="setting-arrow">></view>
        </view>
      </view>

      <view class="setting-action-item" bindtap="showAbout">
        <view class="setting-icon-wrapper">
          <view class="setting-icon about-icon">ℹ️</view>
        </view>
        <view class="setting-content">
          <view class="setting-name">关于应用</view>
          <view class="setting-desc">查看应用版本和信息</view>
        </view>
        <view class="setting-arrow">></view>
      </view>

      <view class="setting-action-item" bindtap="showHelp">
        <view class="setting-icon-wrapper">
          <view class="setting-icon help-icon">❓</view>
        </view>
        <view class="setting-content">
          <view class="setting-name">帮助反馈</view>
          <view class="setting-desc">获取帮助或提交反馈</view>
        </view>
        <view class="setting-arrow">></view>
      </view>

      <!-- 通知功能测试菜单已隐藏
      <view class="setting-action-item" bindtap="goToTestNotification">
        <view class="setting-icon-wrapper">
          <view class="setting-icon test-icon">🧪</view>
        </view>
        <view class="setting-content">
          <view class="setting-name">通知功能测试</view>
          <view class="setting-desc">测试通知管理器功能</view>
        </view>
        <view class="setting-arrow">></view>
      </view>
      -->

      <view class="setting-action-item logout-item" bindtap="handleLogout">
        <view class="setting-icon-wrapper">
          <view class="setting-icon logout-icon">🚪</view>
        </view>
        <view class="setting-content">
          <view class="setting-name">退出登录</view>
          <view class="setting-desc">安全退出当前账户</view>
        </view>
        <view class="setting-arrow">></view>
      </view>
  </view>

    <!-- 通知开启时，额外安全留白，防止底部导航遮挡底部按钮 -->
    <view wx:if="{{notificationsEnabled}}" class="safe-bottom-spacer"></view>

  </view>
</view>

<!-- 底部导航栏（非 Tab 页复用） -->
<bottom-nav active="profile" />
