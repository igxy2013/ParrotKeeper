<view class="page-container">
  <app-header title="收支类别管理" showBack="true"></app-header>
  <view class="page-content">
    <!-- Tabs -->
    <view class="tabs">
      <view class="tab {{activeTab === 'expense' ? 'active' : ''}}" bindtap="switchTab" data-type="expense">支出类别</view>
      <view class="tab {{activeTab === 'income' ? 'active' : ''}}" bindtap="switchTab" data-type="income">收入类别</view>
    </view>

    <view class="category-list">
      <view class="category-grid">
        <block wx:for="{{categories}}" wx:key="id">
          <view class="category-grid-item">
            <view class="category-icon-wrapper">
              <image class="category-icon" src="{{item.icon}}" mode="aspectFit" />
              <view class="category-actions" wx:if="{{item.is_custom}}">
                <view class="action-btn delete" bindtap="deleteCategory" data-id="{{item.id}}">删除</view>
              </view>
            </view>
            <text class="category-name">{{item.name}}</text>
            <text class="category-tag" wx:if="{{!item.is_custom}}">系统</text>
          </view>
        </block>
      </view>
      <view class="empty-tip" wx:if="{{categories.length === 0}}">
        <text class="empty-icon">📋</text>
        <text class="empty-text">暂无数据</text>
      </view>
    </view>

    <view class="add-btn-wrapper">
      <button class="add-btn" bindtap="showAddModal">添加新类别</button>
    </view>
  </view>

  <!-- Add Modal -->
  <view class="modal" wx:if="{{showModal}}" catchtouchmove="true">
    <view class="modal-mask" bindtap="hideAddModal"></view>
    <view class="modal-content" catchtap="stopPropagation">
      <!-- 渐变头部与关闭按钮 -->
      <view class="modal-header-gradient">
        <view class="modal-header-row">
          <text class="modal-title">添加{{activeTab === 'expense' ? '支出' : '收入'}}类别</text>
          <view class="modal-close-btn" bindtap="hideAddModal">
            <image class="modal-close-icon-img" src="/images/remix/close-line-white.png" mode="widthFix"/>
          </view>
        </view>
      </view>
      
      <!-- 弹窗主体内容 -->
      <view class="modal-body">
        <view class="form-section">
          <view class="form-item">
            <text class="form-label">类别名称</text>
            <input 
              class="text-input" 
              placeholder="请输入类别名称" 
              value="{{newCategoryName}}" 
              bindinput="onInputName"
              maxlength="20"
            />
          </view>
        </view>
      </view>
      
      <!-- 底部按钮 -->
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="hideAddModal">取消</button>
        <button class="btn-primary" bindtap="addCategory">确定</button>
      </view>
    </view>
  </view>
</view>
