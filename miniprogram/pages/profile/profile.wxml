<!--pages/profile/profile.wxml-->
<view class="page-container {{pageThemeClass}}">
  <app-header title="ä¸ªäººä¸­å¿ƒ" subtitle="ç®¡ç†æ‚¨çš„è´¦æˆ·ä¿¡æ¯"></app-header>
  <view class="page-content">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card" wx:if="{{isLogin}}">
    <view class="card-background"></view>
    <view class="user-avatar">
      <view class="avatar-container" bindtap="toggleAvatarEdit" wx:if="{{isEditingNickname}}">
        <image 
          class="avatar-image editable" 
          src="{{userInfo.avatar_url || '/images/default-avatar.png'}}" 
          mode="aspectFill"
        />
        <view class="avatar-edit-overlay">
          <view class="edit-icon">ğŸ“·</view>
          <text class="avatar-edit-text">ç‚¹å‡»é€‰æ‹©</text>
        </view>
      </view>
      <image 
        class="avatar-image" 
        src="{{userInfo.avatar_url || '/images/default-avatar.png'}}" 
        mode="aspectFill"
        wx:else
      />
    </view>
    <view class="user-info">
      <view class="nickname-display">
        <text class="user-name">{{userInfo.nickname || 'é¹¦é¹‰çˆ±å¥½è€…'}}</text>
        <view class="edit-nickname-btn" bindtap="toggleNicknameEdit">
          <view class="edit-icon">âœï¸</view>
        </view>
      </view>
      <text class="user-role">{{roleDisplay}}</text>
      <view class="nickname-edit" wx:if="{{isEditingNickname}}">
        <input 
          class="nickname-edit-input" 
          type="nickname" 
          placeholder="è¯·è¾“å…¥æ–°æ˜µç§°" 
          value="{{editNickname}}"
          bindinput="onEditNicknameInput"
          maxlength="20"
        />
        <view class="edit-actions">
          <button class="save-btn" bindtap="saveNickname">ä¿å­˜</button>
          <button class="cancel-btn" bindtap="cancelNicknameEdit">å–æ¶ˆ</button>
        </view>
      </view>
      <view class="info-row">
        <text class="join-date">åŠ å…¥æ—¶é—´ï¼š{{joinDate}}</text>
        <view class="points-row">
          <text class="user-points">ç§¯åˆ†ï¼š</text>
          <text class="user-points-val">{{points}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="login-prompt" wx:if="{{!isLogin}}">
    <view class="login-card">
      <view class="login-icon">ğŸ¦œ</view>
      <text class="login-text">æ¬¢è¿ä½¿ç”¨é¹¦é¹‰ç®¡å®¶</text>
      <text class="login-subtitle">è¯·å…ˆç™»å½•ä»¥æŸ¥çœ‹ä¸ªäººä¿¡æ¯</text>
      <button class="login-btn" bindtap="handleLogin">å¾®ä¿¡å¿«é€Ÿç™»å½•</button>
    </view>
  </view>



  <!-- åŠŸèƒ½å¡ç‰‡åŒºåŸŸ -->
  <view class="function-cards" wx:if="{{isLogin}}">
    <!-- æ¨¡å¼è®¾ç½®å¡ç‰‡ -->
      <view class="function-card mode-card">
        <view class="section-title">
          <text class="title-icon">âš™ï¸</text>
          <text>æ¨¡å¼è®¾ç½®</text>
        </view>
        <view class="mode-toggle">
          <view class="mode-pill {{userMode === 'personal' ? 'active' : ''}}" data-mode="personal" bindtap="chooseUserMode">ä¸ªäººæ¨¡å¼</view>
          <view class="mode-pill {{userMode === 'team' ? 'active' : ''}}" data-mode="team" bindtap="chooseUserMode">å›¢é˜Ÿæ¨¡å¼</view>
        </view>
    </view>
  </view>

<!-- å¤´åƒé€‰æ‹©å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showAvatarModal}}" bindtap="hideAvatarModal">
  <view class="modal-container avatar-modal" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©å¤´åƒ</text>
      <text class="modal-close" bindtap="hideAvatarModal">Ã—</text>
    </view>
    <view class="modal-body">
      <view class="avatar-options">
        <view class="avatar-option" 
              wx:for="{{avatarOptions}}" 
              wx:key="index"
              bindtap="selectAvatar"
              data-avatar="{{item}}">
          <image class="option-avatar {{selectedAvatar === item ? 'selected' : ''}}" 
                 src="{{item}}" 
                 mode="aspectFill" />
        </view>
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn btn-secondary" bindtap="hideAvatarModal">å–æ¶ˆ</button>
      <button class="btn btn-primary" bindtap="confirmAvatarChange" disabled="{{!selectedAvatar}}">ç¡®è®¤é€‰æ‹©</button>
    </view>
  </view>
</view>

<!-- åœ¨ç”¨æˆ·ä¿¡æ¯å¡ç‰‡åæ–°å¢ç»Ÿè®¡ç½‘æ ¼ -->
<view class="stats-grid" wx:if="{{isLogin}}">
  <view class="stat-card red">
    <view class="stat-icon">â¤ï¸</view>
    <view class="stat-value">{{stats.parrotCount}}</view>
    <view class="stat-label">æˆ‘çš„é¹¦é¹‰</view>
  </view>
  <view class="stat-card orange">
    <view class="stat-icon">ğŸ½ï¸</view>
    <view class="stat-value">{{stats.totalFeedings}}</view>
    <view class="stat-label">æ€»å–‚é£Ÿæ¬¡æ•°</view>
  </view>
  <view class="stat-card green">
    <view class="stat-icon">ğŸ›¡ï¸</view>
    <view class="stat-value">{{stats.totalCheckups}}</view>
    <view class="stat-label">å¥åº·æ£€æŸ¥</view>
  </view>
</view>

<!-- æˆå°±æ¨¡å— -->
<view class="achievements-card" wx:if="{{isLogin && userMode !== 'team'}}">
  <view class="section-title">
    <text class="title-icon">ğŸ†</text>
    <text>æˆ‘çš„æˆå°±</text>
  </view>
  <view class="achievements-grid">
    <block wx:for="{{achievements}}" wx:key="index">
      <view class="achievement-item {{item.unlocked ? 'unlocked' : 'locked'}}">
        <view class="achievement-icon {{item.bgClass}}">{{item.icon}}</view>
        <view class="achievement-title">{{item.title}}</view>
        <view class="achievement-desc">{{item.desc}}</view>
        <view class="achievement-progress" wx:if="{{!item.unlocked}}">
          <text class="progress-text">{{stats[item.condition] || 0}}/{{item.target}}</text>
        </view>
        <view class="achievement-badge" wx:if="{{item.unlocked}}">
          <text class="badge-text">å·²è§£é”</text>
        </view>
      </view>
    </block>
  </view>
</view>

<!-- å›¢é˜Ÿåä½œæ¨¡å—ï¼ˆä»…å›¢é˜Ÿæ¨¡å¼æ˜¾ç¤ºï¼‰ -->
<view class="team-card" wx:if="{{isLogin && userMode === 'team'}}">
  <view class="section-title">
    <text class="title-icon">ğŸ‘¥</text>
    <text>å›¢é˜Ÿåä½œ</text>
  </view>
  <view class="team-list">
    <block wx:for="{{teamItems}}" wx:key="index">
      <view class="team-item" bindtap="onTeamItemTap" data-title="{{item.title}}">
        <view class="team-item-icon {{item.bgClass}}">{{item.icon}}</view>
        <view class="team-item-content">
          <view class="team-item-title">{{item.title}}</view>
          <view class="team-item-desc">{{item.desc}}</view>
        </view>
        <text class="arrow">></text>
      </view>
    </block>
  </view>
</view>

<!-- åŠŸèƒ½èœå•æ¨¡å— -->
<view class="menu-card">
  <view class="section-title">
    <text class="title-icon">ğŸ“‹</text>
    <text>åŠŸèƒ½èœå•</text>
  </view>
  <view class="menu-list">
    <block wx:for="{{menuItems}}" wx:key="index">
      <view class="menu-item" bindtap="onMenuItemTap" data-title="{{item.title}}">
        <view class="menu-item-icon {{item.bgClass}}">{{item.icon}}</view>
        <view class="menu-item-content">
          <view class="menu-item-title">{{item.title}}</view>
          <view class="menu-item-desc">{{item.desc}}</view>
        </view>
        <text class="arrow">></text>
      </view>
    </block>
  </view>
</view>

<!-- ç‰ˆæœ¬ä¿¡æ¯æ¨¡å— -->
<view class="version-card">
  <view class="version-logo">â¤ï¸</view>
  <view class="version-title">é¹¦é¹‰ç®¡å®¶</view>
  <view class="version-sub">ä¸“ä¸šçš„é¹¦é¹‰æŠ¤ç†åŠ©æ‰‹</view>
  <view class="version-info">ç‰ˆæœ¬ 1.0.0 â€¢ ç”¨å¿ƒå‘µæŠ¤æ¯ä¸€åªå°é¹¦é¹‰</view>
</view>
</view>
<!-- è‡ªå®šä¹‰åº•éƒ¨å¯¼èˆª -->
<bottom-nav active="profile" />
</view>
