<view class="page-container">
  <app-header title="账号管理" subtitle="绑定或设置登录账号" showBack="true"></app-header>
  <view class="page-content">
    <view class="status-card">
      <view class="status-header">
        <text class="status-title">当前状态</text>
        <view class="status-badge {{username ? 'active' : ''}}">
          {{username ? '已设置账号' : '未设置账号'}}
        </view>
      </view>
       <view class="status-info">
         <view class="info-row">
            <text class="label">登录账号</text>
            <text class="value">{{username || '未绑定'}}</text>
         </view>
         <view class="info-row">
            <text class="label">微信账号</text>
            <text class="value highlight">已绑定</text>
         </view>
      </view>
    </view>

    <view class="section-card">
      <view class="section-header">
        <text class="section-title">账号绑定</text>
      </view>
      <view class="cell-list">
        <view class="cell-item" bindtap="onAccountTap">
          <view class="cell-label">登录账号</view>
          <view class="cell-value {{username ? '' : 'placeholder'}}">
            {{username || '未绑定'}}
          </view>
          <view class="cell-arrow">></view>
        </view>
      </view>
    </view>
  </view>

  <!-- Bind Modal -->
  <view class="modal-overlay" wx:if="{{showBindModal}}" bindtap="hideBindModal">
    <view class="modal-container" catchtap="stopPropagation">
       <view class="modal-header">
         <text>绑定已有账号</text>
         <view class="close-btn" bindtap="hideBindModal">×</view>
       </view>
       <view class="modal-body">
          <view class="input-group">
            <text class="input-label">用户名</text>
            <input class="input" placeholder="请输入已有账号用户名" value="{{bindUsername}}" bindinput="onBindUsernameInput" />
          </view>
          <view class="input-group">
            <text class="input-label">密码</text>
            <input class="input" password placeholder="请输入密码" value="{{bindPassword}}" bindinput="onBindPasswordInput" />
          </view>
          <view class="warning-text">注意：绑定后将切换至目标账号，当前临时数据可能丢失。</view>
       </view>
       <view class="modal-footer">
          <button class="btn cancel" bindtap="hideBindModal">取消</button>
          <button class="btn confirm" bindtap="handleBind">确认绑定</button>
       </view>
    </view>
  </view>

  <!-- Setup Modal -->
  <view class="modal-overlay" wx:if="{{showSetupModal}}" bindtap="hideSetupModal">
    <view class="modal-container" catchtap="stopPropagation">
       <view class="modal-header">
         <text>建立新账号</text>
         <view class="close-btn" bindtap="hideSetupModal">×</view>
       </view>
       <view class="modal-body">
          <view class="input-group">
            <text class="input-label">用户名</text>
            <input class="input {{setupUsernameError ? 'error-border' : ''}}" 
                   placeholder="设置用户名" 
                   value="{{setupUsername}}" 
                   bindinput="onSetupUsernameInput"
                   bindblur="checkSetupUsername" />
            <view class="error-text" wx:if="{{setupUsernameError}}">
               <icon type="warn" size="14" color="#ef4444" style="margin-right: 8rpx;"/>
               <text >{{setupUsernameError}}</text>
            </view>
          </view>
          <view class="input-group">
            <text class="input-label">密码</text>
            <input class="input" password placeholder="设置密码" model:value="{{setupPassword}}" />
          </view>
          <view class="input-group">
            <text class="input-label">确认密码</text>
            <input class="input" password placeholder="再次输入密码" model:value="{{setupConfirmPassword}}" />
          </view>
       </view>
       <view class="modal-footer">
          <button class="btn cancel" bindtap="hideSetupModal">取消</button>
          <button class="btn confirm" bindtap="handleSetup">确认设置</button>
       </view>
    </view>
  </view>
</view>
