<!--pages/breeding/breeding.wxml-->
<view class="page-container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <app-header 
    title="ç¹æ®–è®°å½•" 
    subtitle="ä¸“ä¸šç¹æ®–ç®¡ç†åŠ©æ‰‹"
    showBack="{{true}}"
  >
    <view slot="actions" class="header-actions">
      <button class="btn btn-primary btn-small" bindtap="showAddForm">
        <text class="action-icon">â•</text>
        æ·»åŠ è®°å½•
      </button>
    </view>
  </app-header>

  <view class="page-content">
    <!-- æ¸¸å®¢æ¨¡å¼æç¤º -->
    <view wx:if="{{!isLogin}}" class="guest-tip">
      <text class="tip-text">ğŸ¥š ç¹æ®–è®°å½•åŠŸèƒ½éœ€è¦ç™»å½•ä½¿ç”¨</text>
      <text class="tip-subtitle">ç™»å½•åå¯ä»¥è®°å½•å’Œç®¡ç†æ‚¨çš„é¹¦é¹‰ç¹æ®–ä¿¡æ¯</text>
    </view>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <view wx:if="{{isLogin}}" class="stats-section">
      <view class="stats-grid">
        <view class="stat-card breeding-pairs">
          <view class="stat-content">
            <view class="stat-info">
              <text class="stat-label">æ€»ç¹æ®–å¯¹æ•°</text>
              <text class="stat-value">{{stats.totalPairs}}</text>
            </view>
            <view class="stat-icon">
              <text class="icon">ğŸ’•</text>
            </view>
          </view>
        </view>
        <view class="stat-card success-hatching">
          <view class="stat-content">
            <view class="stat-info">
              <text class="stat-label">æˆåŠŸå­µåŒ–</text>
              <text class="stat-value">{{stats.successfulHatching}}</text>
            </view>
            <view class="stat-icon">
              <text class="icon">ğŸ£</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- çŠ¶æ€ç­›é€‰ -->
    <view wx:if="{{isLogin}}" class="filter-section">
      <scroll-view class="status-filter" scroll-x="true">
        <view class="filter-options">
          <view 
            class="filter-option {{selectedStatus === item ? 'active' : ''}}"
            wx:for="{{statusOptions}}" 
            wx:key="*this"
            bindtap="selectStatus"
            data-status="{{item}}"
          >
            <text class="option-text">{{item}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- ç¹æ®–è®°å½•åˆ—è¡¨ -->
    <view wx:if="{{isLogin}}" class="records-section">
      <view class="record-list" wx:if="{{filteredRecords.length > 0}}">
        <view 
          class="record-card" 
          wx:for="{{filteredRecords}}" 
          wx:key="id"
          bindtap="viewRecordDetail"
          data-record="{{item}}"
        >
          <view class="record-header">
            <view class="record-info">
              <text class="parrot-pair">{{item.parrotPair}}</text>
              <view class="status-badge {{item.statusClass}}">
                <text class="status-text">{{item.status}}</text>
              </view>
            </view>
            <view class="record-date">
              <text class="date-text">{{item.createdAt}}</text>
            </view>
          </view>

          <view class="record-details">
            <view class="detail-grid">
              <view class="detail-item">
                <text class="detail-label">ç­‘å·¢æ—¥æœŸ</text>
                <text class="detail-value">{{item.nestingDate || '-'}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">äº§è›‹æ—¥æœŸ</text>
                <text class="detail-value">{{item.layingDate || '-'}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">å­µåŒ–æ—¥æœŸ</text>
                <text class="detail-value">{{item.hatchingDate || '-'}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">å­µåŒ–ç‡</text>
                <text class="detail-value">{{item.hatchingRate}}</text>
              </view>
            </view>
          </view>

          <view wx:if="{{item.notes}}" class="record-notes">
            <text class="notes-text">{{item.notes}}</text>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{filteredRecords.length === 0 && !loading}}">
        <view class="empty-icon">ğŸ¥š</view>
        <view class="empty-text">æš‚æ— ç¹æ®–è®°å½•</view>
        <view class="empty-subtitle">å¼€å§‹è®°å½•æ‚¨çš„é¹¦é¹‰ç¹æ®–è¿‡ç¨‹</view>
        <view class="btn-primary" bindtap="showAddForm">æ·»åŠ ç¹æ®–è®°å½•</view>
      </view>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{loading}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ è®°å½•å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showAddModal}}" bindtap="hideAddForm">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ ç¹æ®–è®°å½•</text>
        <view class="modal-close" bindtap="hideAddForm">Ã—</view>
      </view>

      <scroll-view class="modal-body" scroll-y="true">
        <view class="form-container">
          <view class="form-section">
            <view class="form-row">
              <view class="form-group">
                <text class="form-label">é›„é¸Ÿ</text>
                <picker 
                  mode="selector" 
                  range="{{parrotOptions}}" 
                  range-key="name"
                  value="{{formData.maleParrotIndex}}"
                  bindchange="onMaleParrotChange"
                >
                  <view class="picker-input">
                    <text class="{{formData.maleParrot ? 'selected' : 'placeholder'}}">
                      {{formData.maleParrot || 'é€‰æ‹©é›„é¸Ÿ'}}
                    </text>
                    <text class="picker-arrow">></text>
                  </view>
                </picker>
              </view>
              <view class="form-group">
                <text class="form-label">é›Œé¸Ÿ</text>
                <picker 
                  mode="selector" 
                  range="{{parrotOptions}}" 
                  range-key="name"
                  value="{{formData.femaleParrotIndex}}"
                  bindchange="onFemaleParrotChange"
                >
                  <view class="picker-input">
                    <text class="{{formData.femaleParrot ? 'selected' : 'placeholder'}}">
                      {{formData.femaleParrot || 'é€‰æ‹©é›Œé¸Ÿ'}}
                    </text>
                    <text class="picker-arrow">></text>
                  </view>
                </picker>
              </view>
            </view>
          </view>

          <view class="form-section">
            <view class="form-group">
              <text class="form-label">ç­‘å·¢æ—¥æœŸ</text>
              <picker 
                mode="date" 
                value="{{formData.nestingDate}}"
                bindchange="onNestingDateChange"
              >
                <view class="picker-input">
                  <text class="{{formData.nestingDate ? 'selected' : 'placeholder'}}">
                    {{formData.nestingDate || 'é€‰æ‹©ç­‘å·¢æ—¥æœŸ'}}
                  </text>
                  <text class="picker-arrow">></text>
                </view>
              </picker>
            </view>

            <view class="form-group">
              <text class="form-label">äº§è›‹æ—¥æœŸ</text>
              <picker 
                mode="date" 
                value="{{formData.layingDate}}"
                bindchange="onLayingDateChange"
              >
                <view class="picker-input">
                  <text class="{{formData.layingDate ? 'selected' : 'placeholder'}}">
                    {{formData.layingDate || 'é€‰æ‹©äº§è›‹æ—¥æœŸ'}}
                  </text>
                  <text class="picker-arrow">></text>
                </view>
              </picker>
            </view>

            <view class="form-group">
              <text class="form-label">å­µåŒ–æ—¥æœŸ</text>
              <picker 
                mode="date" 
                value="{{formData.hatchingDate}}"
                bindchange="onHatchingDateChange"
              >
                <view class="picker-input">
                  <text class="{{formData.hatchingDate ? 'selected' : 'placeholder'}}">
                    {{formData.hatchingDate || 'é€‰æ‹©å­µåŒ–æ—¥æœŸ'}}
                  </text>
                  <text class="picker-arrow">></text>
                </view>
              </picker>
            </view>
          </view>

          <view class="form-section">
            <view class="form-row">
              <view class="form-group">
                <text class="form-label">è›‹æ•°</text>
                <input 
                  class="form-input" 
                  type="number" 
                  placeholder="è¾“å…¥è›‹æ•°"
                  value="{{formData.eggCount}}"
                  bindinput="onEggCountInput"
                />
              </view>
              <view class="form-group">
                <text class="form-label">å­µåŒ–æ•°</text>
                <input 
                  class="form-input" 
                  type="number" 
                  placeholder="è¾“å…¥å­µåŒ–æ•°"
                  value="{{formData.hatchedCount}}"
                  bindinput="onHatchedCountInput"
                />
              </view>
            </view>
          </view>

          <view class="form-section">
            <view class="form-group">
              <text class="form-label">çŠ¶æ€</text>
              <picker 
                mode="selector" 
                range="{{breedingStatusOptions}}" 
                value="{{formData.statusIndex}}"
                bindchange="onStatusChange"
              >
                <view class="picker-input">
                  <text class="{{formData.status ? 'selected' : 'placeholder'}}">
                    {{formData.status || 'é€‰æ‹©çŠ¶æ€'}}
                  </text>
                  <text class="picker-arrow">></text>
                </view>
              </picker>
            </view>
          </view>

          <view class="form-section">
            <view class="form-group">
              <text class="form-label">å¤‡æ³¨</text>
              <textarea 
                class="form-textarea" 
                placeholder="è®°å½•ç¹æ®–è¿‡ç¨‹ä¸­çš„é‡è¦ä¿¡æ¯..."
                value="{{formData.notes}}"
                bindinput="onNotesInput"
                maxlength="500"
              />
            </view>
          </view>

          <view class="form-actions">
              <view class="btn-cancel" bindtap="hideAddForm">å–æ¶ˆ</view>
              <view class="btn-submit" bindtap="submitForm">æ·»åŠ è®°å½•</view>
            </view>
          </view>
      </scroll-view>
    </view>
  </view>
</view>