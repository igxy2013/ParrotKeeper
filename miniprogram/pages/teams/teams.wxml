<!--pages/teams/teams.wxml-->
<view class="container">
  <!-- 页面头部 -->
  <view class="page-header">
    <view class="header-title">团队协作</view>
    <view class="header-subtitle">管理您的团队，提升协作效率</view>
  </view>

  <!-- 团队信息卡片 -->
  <view class="team-info-card">
    <view class="team-header">
      <view class="team-icon-wrapper">
        <view class="team-icon">🦜</view>
        <view class="team-status-indicator active"></view>
      </view>
      <view class="team-details">
        <view class="team-name">{{teamInfo.name}}</view>
        <view class="team-meta">
          <view class="create-info">
            <text class="create-time">创建于 {{teamInfo.createTime}}</text>
            <view class="status-badge active">{{teamInfo.status}}</view>
          </view>
        </view>
      </view>
      <view class="team-actions">
        <view class="action-btn settings" bindtap="openSettings">
          <text class="action-icon">⚙️</text>
        </view>
      </view>
    </view>
    
    <!-- 统计数据 -->
    <view class="stats-container">
      <view class="stat-item">
        <view class="stat-icon-bg members">
          <view class="stat-icon">👥</view>
        </view>
        <view class="stat-content">
          <view class="stat-number">{{teamInfo.memberCount}}</view>
          <view class="stat-label">团队成员</view>
        </view>
      </view>
      <view class="stat-item">
        <view class="stat-icon-bg records">
          <view class="stat-icon">📝</view>
        </view>
        <view class="stat-content">
          <view class="stat-number">{{teamInfo.recordCount}}</view>
          <view class="stat-label">饲养记录</view>
        </view>
      </view>
      <view class="stat-item">
        <view class="stat-icon-bg tasks">
          <view class="stat-icon">📅</view>
        </view>
        <view class="stat-content">
          <view class="stat-number">{{teamInfo.todayTasks}}</view>
          <view class="stat-label">今日任务</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 快速操作 -->
  <view class="section">
    <view class="section-header">
      <view class="section-title">
        <view class="title-icon">⚡</view>
        <text>快速操作</text>
      </view>
    </view>
    <view class="quick-actions">
      <view class="action-item" data-id="invite" bindtap="onQuickActionTap" style="--action-color: #10b981">
        <view class="action-icon-wrapper"><view class="action-icon">👤</view></view>
        <view class="action-content">
          <view class="action-name">邀请成员</view>
        </view>
      </view>
      <view class="action-item" data-id="addRecord" bindtap="onQuickActionTap" style="--action-color: #60a5fa">
        <view class="action-icon-wrapper"><view class="action-icon">➕</view></view>
        <view class="action-content">
          <view class="action-name">添加记录</view>
        </view>
      </view>
      <view class="action-item" data-id="createTask" bindtap="onQuickActionTap" style="--action-color: #a78bfa">
        <view class="action-icon-wrapper"><view class="action-icon">📅</view></view>
        <view class="action-content">
          <view class="action-name">创建任务</view>
        </view>
      </view>
      <view class="action-item" data-id="settings" bindtap="onQuickActionTap" style="--action-color: #fb923c">
        <view class="action-icon-wrapper"><view class="action-icon">⚙️</view></view>
        <view class="action-content">
          <view class="action-name">团队设置</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 团队成员 -->
  <view class="section">
    <view class="section-header">
      <view class="section-title">
        <view class="title-icon">👥</view>
        <text>团队成员</text>
      </view>
      <view class="section-extra">
        <view class="member-count">{{members.length}}人</view>
        <view class="invite-btn-small" bindtap="inviteNewMember">邀请成员</view>
      </view>
    </view>
    
    <view class="members-container">
      <!-- 搜索和筛选 -->
      <view class="search-filter-section">
        <view class="search-bar">
          <view class="search-icon">🔍</view>
          <input 
            class="search-input" 
            placeholder="搜索成员姓名或角色"
            value="{{searchKeyword}}"
            bindinput="onSearchInput"
          />
          <view class="search-clear" wx:if="{{searchKeyword}}" bindtap="clearSearch">✕</view>
        </view>
        
        <view class="filter-tabs">
          <view 
            class="filter-tab {{selectedRole === 'all' ? 'active' : ''}}"
            data-role="all"
            bindtap="onRoleFilter"
          >
            全部
          </view>
          <view 
            class="filter-tab {{selectedRole === '管理员' ? 'active' : ''}}"
            data-role="管理员"
            bindtap="onRoleFilter"
          >
            管理员
          </view>
          <view 
            class="filter-tab {{selectedRole === '编辑者' ? 'active' : ''}}"
            data-role="编辑者"
            bindtap="onRoleFilter"
          >
            编辑者
          </view>
          <view 
            class="filter-tab {{selectedRole === '成员' ? 'active' : ''}}"
            data-role="成员"
            bindtap="onRoleFilter"
          >
            成员
          </view>
        </view>
      </view>

      <!-- 在线成员统计 -->
      <view class="online-stats">
        <view class="online-indicator"></view>
        <text class="online-text">{{onlineMembersCount}}人在线</text>
      </view>

      <!-- 成员列表 -->
      <view class="members-list">
        <view 
          class="member-item-detailed" 
          wx:for="{{filteredMembers}}" 
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="onMemberTap"
        >
          <view class="member-main">
            <view class="member-avatar-section">
              <view class="member-avatar-container">
                <image class="member-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
                <view class="online-status {{item.isOnline ? 'online' : 'offline'}}"></view>
              </view>
            </view>
            
            <view class="member-info-section">
              <view class="member-basic-info">
                <view class="member-name">{{item.name}}</view>
                <view class="member-role-badge {{item.role === '管理员' ? 'admin' : item.role === '编辑者' ? 'editor' : 'member'}}">
                  <view class="role-icon">{{item.role === '管理员' ? '👑' : item.role === '编辑者' ? '✏️' : '👤'}}</view>
                  <text class="role-text">{{item.role}}</text>
                </view>
              </view>
              <view class="member-meta-info">
                <view class="meta-item">
                  <view class="meta-icon">📅</view>
                  <text class="meta-text">加入于 {{item.joinTime}}</text>
                </view>
                <view class="meta-item">
                  <view class="meta-icon">⏰</view>
                  <text class="meta-text">最后活跃: {{item.lastActive}}</text>
                </view>
              </view>
            </view>
          </view>
          
          <view class="member-actions">
            <view 
              class="action-btn primary"
              data-id="{{item.id}}"
              bindtap="manageMemberPermissions"
              catchtap="manageMemberPermissions"
            >
              <text class="action-icon">⚙️</text>
            </view>
            <view 
              class="action-btn secondary"
              data-id="{{item.id}}"
              bindtap="viewMemberProfile"
              catchtap="viewMemberProfile"
            >
              <text class="action-icon">👁️</text>
            </view>
          </view>
        </view>
        
        <!-- 空状态 -->
        <view class="empty-state" wx:if="{{filteredMembers.length === 0}}">
          <view class="empty-icon">👥</view>
          <view class="empty-text">没有找到匹配的成员</view>
          <view class="empty-desc">尝试调整搜索条件或筛选选项</view>
          <view class="empty-action" bindtap="resetFilters">重置筛选</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 最近活动 -->
  <view class="section">
    <view class="section-header">
      <view class="section-title">
        <view class="title-icon">📊</view>
        <text>最近活动</text>
      </view>
    </view>
    <view class="activity-container">
      <view class="activity-item" wx:for="{{recentActivities}}" wx:key="id">
        <view class="activity-avatar">
          <image src="{{item.userAvatar}}" mode="aspectFill"></image>
        </view>
        <view class="activity-content">
          <view class="activity-text">
            <text class="user-name">{{item.userName}}</text>
            <text class="activity-desc">{{item.action}}</text>
          </view>
          <view class="activity-time">{{item.time}}</view>
        </view>
      </view>
      
      <view class="empty-activity" wx:if="{{!recentActivities || recentActivities.length === 0}}">
        <view class="empty-icon">📝</view>
        <view class="empty-text">暂无最近活动</view>
        <view class="empty-desc">团队成员的操作记录将在这里显示</view>
      </view>
    </view>
  </view>
</view>