<!--pages/expenses/add-expense/add-expense.wxml-->
<view class="page-container">
  <app-header title="添加支出" subtitle="记录一笔支出" showBack="{{true}}"></app-header>
  <view class="page-content">
  <form bindsubmit="onSubmit">
    <view class="form-section">
      <view class="section-title">添加支出记录</view>
      
      <view class="form-item">
        <text class="form-label required">支出类别</text>
        <picker bindchange="onCategoryChange" range="{{categories}}" range-key="label" value="{{selectedCategoryIndex}}">
          <view class="form-picker">
            <text class="picker-text {{formData.category ? '' : 'placeholder'}}">
              {{selectedCategoryLabel || '请选择类别'}}
            </text>
            <text class="picker-arrow">▼</text>
          </view>
        </picker>
      </view>

      <view class="form-item">
        <text class="label required">支出金额</text>
        <input 
          class="form-input"
          type="digit" 
          placeholder="请输入金额" 
          value="{{formData.amount}}"
          bindinput="onAmountInput"
          focus="{{true}}"
          cursor-spacing="10"
          confirm-type="done"
        />
      </view>

      <view class="form-item">
        <text class="form-label">支出描述</text>
        <textarea 
          class="form-textarea" 
          placeholder="请输入支出描述（可选）" 
          value="{{formData.description}}"
          bindinput="onDescriptionInput"
          maxlength="200"
          cursor-spacing="0"
          show-confirm-bar="{{false}}"
        />
        <view class="char-count">{{formData.description.length}}/200</view>
      </view>

      <view class="form-item">
        <text class="form-label required">支出日期</text>
        <picker mode="date" bindchange="onDateChange" value="{{formData.expense_date}}">
          <view class="form-picker">
            <text class="picker-text {{formData.expense_date ? '' : 'placeholder'}}">
              {{formData.expense_date || '请选择日期'}}
            </text>
            <text class="picker-arrow">▼</text>
          </view>
        </picker>
      </view>

    </view>

    <view class="form-actions">
      <button class="btn btn-secondary" type="button" bindtap="onReset">重置</button>
      <button 
        class="btn btn-primary" 
        form-type="submit" 
        disabled="{{submitting}}"
        loading="{{submitting}}"
      >
        {{submitting ? '保存中...' : '保存支出'}}
      </button>
    </view>
  </form>
  </view>
</view>
