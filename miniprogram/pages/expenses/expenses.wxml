<!--pages/expenses/expenses.wxml-->
<view class="page-container">
  <app-header title="æ”¶æ”¯ç®¡ç†" subtitle="è®°å½•é¹¦é¹‰ç›¸å…³æ”¶å…¥æ”¯å‡º" showBack="{{true}}" theme="orange">
    <view slot="actions" class="header-actions">
      <view class="header-add-btn" bindtap="onShowAddRecord">
        <text class="add-icon">ï¼‹</text>
      </view>
    </view>
  </app-header>

  <view class="page-content">
    <!-- é¡¶éƒ¨æ—¶é—´æ®µé€‰æ‹©å™¨ -->
    <view class="period-selector-card">
      <view class="period-btn {{selectedPeriod === 'ä»Šå¤©' ? 'active' : ''}}" bindtap="setSelectedPeriod" data-period="ä»Šå¤©">ä»Šå¤©</view>
      <view class="period-btn {{selectedPeriod === 'æœ¬å‘¨' ? 'active' : ''}}" bindtap="setSelectedPeriod" data-period="æœ¬å‘¨">æœ¬å‘¨</view>
      <view class="period-btn {{selectedPeriod === 'æœ¬æœˆ' ? 'active' : ''}}" bindtap="setSelectedPeriod" data-period="æœ¬æœˆ">æœ¬æœˆ</view>
      <view class="period-btn {{selectedPeriod === 'æœ¬å¹´' ? 'active' : ''}}" bindtap="setSelectedPeriod" data-period="æœ¬å¹´">æœ¬å¹´</view>
      <view class="period-btn {{selectedPeriod === 'å…¨éƒ¨' ? 'active' : ''}}" bindtap="setSelectedPeriod" data-period="å…¨éƒ¨">å…¨éƒ¨</view>
    </view>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-grid two-columns">
      <view class="stat-card income">
        <view class="stat-icon">â¬†ï¸</view>
        <view class="stat-value">Â¥{{stats.localTotalIncome || 0}}</view>
        <view class="stat-label">æ”¶å…¥</view>
      </view>
      <view class="stat-card expense">
        <view class="stat-icon">â¬‡ï¸</view>
        <view class="stat-value">Â¥{{stats.localTotalExpense || 0}}</view>
        <view class="stat-label">æ”¯å‡º</view>
      </view>
    </view>



    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="card">
      <view class="card-header">
        <text class="card-title">è®°å½•åˆ—è¡¨</text>
 <text class="total-text">å…± {{totalCount || filteredRecords.length}} æ¡</text>
      </view>
      <view class="card-content">
        <view class="list-container">
      <block wx:for="{{filteredRecords}}" wx:key="id">
        <view class="list-item">
          <view class="list-item-content">
            <view class="list-item-main">
              <view class="list-item-title">
                <text class="type-tag {{item.type === 'æ”¶å…¥' ? 'income' : 'expense'}}">{{item.type}}</text>
                <text class="category-tag">{{item.category}}</text>
              </view>
              <view class="list-item-desc">{{item.description || 'æ— æè¿°'}}</view>
              <view class="list-item-meta">
                <text class="date-tag">{{item.date}} {{item.time}}</text>
                <text class="parrot-tag" wx:if="{{item.parrot}}">{{item.parrot}}</text>
              </view>
            </view>
            <view class="list-item-right">
              <view class="list-item-value {{item.type === 'æ”¶å…¥' ? 'income' : 'expense'}}">Â¥{{item.amount}}</view>
              <view class="list-item-actions">
                <button class="action-btn edit-btn" bindtap="onEditRecord" data-record="{{item}}">
                  <text class="action-icon">âœï¸</text>
                </button>
                <button class="action-btn delete-btn" bindtap="onDeleteRecord" data-record="{{item}}">
                  <text class="action-icon">ğŸ—‘ï¸</text>
                </button>
              </view>
            </view>
          </view>
        </view>
      </block>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{loading}}"><text>åŠ è½½ä¸­...</text></view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{!loading && filteredRecords.length === 0}}">
        <view class="empty-icon">ğŸ’°</view>
        <text class="empty-text">æš‚æ— è®°å½•</text>
      </view>
        </view>
      </view>
    </view>

    <!-- æ·»åŠ æ”¶æ”¯è®°å½•å¼¹çª—ç»„ä»¶ -->
    <expense-modal 
      visible="{{showAddRecord}}" 
      modalTopOffsetPx="{{modalTopOffsetPx}}"
      modalBottomOffsetPx="{{modalBottomOffsetPx}}"
      bind:close="onHideAddRecord"
      bind:success="onExpenseSuccess"
    />

    <!-- ç¼–è¾‘æ”¶æ”¯è®°å½•å¼¹çª—ç»„ä»¶ -->
    <expense-modal 
      visible="{{showEditRecord}}" 
      modalTopOffsetPx="{{modalTopOffsetPx}}"
      modalBottomOffsetPx="{{modalBottomOffsetPx}}"
      isEdit="{{true}}"
      editRecord="{{editRecord}}"
      bind:close="onHideEditRecord"
      bind:success="onExpenseSuccess"
    />
  </view>
</view>
