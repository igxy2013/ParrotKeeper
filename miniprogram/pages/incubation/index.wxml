<view class="page-container">
  <app-header title="äººå·¥å­µåŒ–" subtitle="ç®¡ç†è›‹ä¸å­µåŒ–æ—¥å¿—" showBack="true">
    <view slot="actions" class="header-action" bindtap="openAddEggModal">
      <image class="header-icon" src="/images/remix/add-circle-fill.png" mode="widthFix" />
    </view>
  </app-header>

  <view class="page-content">
    <block wx:if="{{loading}}"><view class="loading">åŠ è½½ä¸­...</view></block>
    <block wx:elif="{{eggs.length === 0}}">
      <view class="empty-state-card">
        <view class="empty-content">
          <view class="empty-icon">ğŸ¥š</view>
          <text class="empty-title">è¿˜æ²¡æœ‰è›‹è®°å½•</text>
          <text class="empty-subtitle">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ æ‚¨çš„ç¬¬ä¸€æšè›‹</text>
          <view class="empty-btn" bindtap="openAddEggModal">
            <view class="empty-btn-text">æ·»åŠ è›‹</view>
          </view>
        </view>
      </view>
    </block>
    <block wx:else>
      <view class="egg-list">
        <view class="egg-item" wx:for="{{eggs}}" wx:key="id" bindtap="openDetail" data-id="{{item.id}}">
          <view class="row">
            <text class="label">{{item.label || ('è›‹ ' + item.id)}}</text>
            <view class="row-right">
              <text class="status">{{item.status_text}}</text>
              <view class="action-buttons" wx:if="{{hasOperationPermission}}">
                <view class="action-btn edit-btn" catchtap="openEditEgg" data-id="{{item.id}}">
                  <image class="action-icon-img" src="/images/remix/edit-line-white.png" mode="aspectFit" />
                </view>
                <view class="action-btn delete-btn" catchtap="deleteEgg" data-id="{{item.id}}">
                  <image class="action-icon-img" src="/images/remix/delete-bin-line-white.png" mode="aspectFit" />
                </view>
              </view>
            </view>
          </view>
          <view class="meta-grid">
            <view class="meta-item">
              <text class="meta-label">å¼€å§‹å­µåŒ–</text>
              <text class="meta-value">{{item.incubator_start_datetime_text || item.incubator_start_date_text || 'æœªè®¾ç½®'}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-label">å¤©æ•°</text>
              <text class="meta-value">{{item.day_since_start_text}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-label">å“ç§</text>
              <text class="meta-value">{{item.species_name || 'æœªè®¾ç½®'}}</text>
            </view>
            <view class="meta-item" wx:if="{{item.hatch_date_text}}">
              <text class="meta-label">å‡ºå£³</text>
              <text class="meta-value">{{item.hatch_date_text}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>
  </view>

  <limit-modal 
    visible="{{showLimitModal}}" 
    mode="info" 
    title="ä¼šå‘˜æç¤º" 
    message="äººå·¥å­µåŒ–ä¸ºä¼šå‘˜åŠŸèƒ½ï¼Œå‡çº§åå¯ç”¨" 
    showRedeem="false" 
    bind:cancel="onLimitCancel" 
    bind:upgrade="onLimitUpgrade" 
  />

  <view class="modal-overlay" wx:if="{{showAddEgg}}" bindtap="closeAddEggModal"></view>
  <view class="modal" wx:if="{{showAddEgg}}" catchtap="noop">
    <view class="modal-header-gradient">
      <view class="modal-header-row">
        <text class="modal-title">æ·»åŠ è›‹</text>
        <view class="modal-close-btn" bindtap="closeAddEggModal"><text class="modal-close-icon">âœ•</text></view>
      </view>
    </view>
    <view class="modal-body">
      <view class="form-item">
        <text class="form-label">æ ‡ç­¾</text>
        <input class="form-input" placeholder="å¦‚ A1" value="{{form.label}}" bindinput="onInput" data-field="label" />
      </view>
      <view class="form-item">
        <text class="form-label">äº§è›‹æ—¥æœŸ</text>
        <picker mode="date" value="{{form.laid_date}}" bindchange="onDateChange" data-field="laid_date">
          <view class="form-picker">{{form.laid_date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
        </picker>
      </view>
      <view class="form-item">
        <text class="form-label">å¼€å§‹å­µåŒ–</text>
        <view class="picker-group">
          <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
            <view class="form-picker">{{startDate || 'æ—¥æœŸ'}}</view>
          </picker>
          <picker mode="time" value="{{startTime}}" bindchange="onStartTimeChange">
            <view class="form-picker">{{startTime || 'æ—¶é—´'}}</view>
          </picker>
        </view>
      </view>
      <view class="form-item">
        <text class="form-label">é¹¦é¹‰å“ç§</text>
        <picker range="{{speciesNames}}" value="{{selectedSpeciesIndex}}" bindchange="onSpeciesChange">
          <view class="form-picker">{{selectedSpeciesIndex >= 0 ? speciesNames[selectedSpeciesIndex] : 'è¯·é€‰æ‹©å“ç§'}}</view>
        </picker>
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn-primary" bindtap="submitEgg">æäº¤</button>
    </view>
  </view>
</view>
