<view class="page-container">
  <app-header title="人工孵化" subtitle="管理蛋与孵化日志" showBack="true">
    <view slot="actions" class="header-action" bindtap="openAddEggModal">
      <image class="header-icon" src="/images/remix/add-circle-fill.png" mode="widthFix" />
    </view>
  </app-header>

  <view class="page-content">
    <block wx:if="{{loading}}"><view class="loading">加载中...</view></block>
    <block wx:elif="{{eggs.length === 0}}"><view class="empty">暂无蛋记录</view></block>
    <block wx:else>
      <view class="egg-list">
        <view class="egg-item" wx:for="{{eggs}}" wx:key="id" bindtap="openDetail" data-id="{{item.id}}">
          <view class="row">
            <text class="label">{{item.label || ('蛋 ' + item.id)}}</text>
            <view class="row-right">
              <text class="status">{{item.status_text}}</text>
              <view class="action-buttons" wx:if="{{hasOperationPermission}}">
                <view class="action-btn edit-btn" catchtap="openEditEgg" data-id="{{item.id}}">
                  <image class="action-icon-img" src="/images/remix/edit-line-white.png" mode="aspectFit" />
                </view>
                <view class="action-btn delete-btn" catchtap="deleteEgg" data-id="{{item.id}}">
                  <image class="action-icon-img" src="/images/remix/delete-bin-line-white.png" mode="aspectFit" />
                </view>
              </view>
            </view>
          </view>
          <view class="meta">
            <view>
              <text>开始孵化</text>
              <view>{{item.incubator_start_datetime_text || item.incubator_start_date_text || '未设置'}}</view>
            </view>
            <view>
              <text>天数</text>
              <view>{{item.day_since_start_text}}</view>
            </view>
            <view>
              <text>品种</text>
              <view>{{item.species_name || '未设置'}}</view>
            </view>
          </view>
          <view class="meta" wx:if="{{item.hatch_date_text}}">
            <view>
              <text>出壳</text>
              <view>{{item.hatch_date_text}}</view>
            </view>
          </view>
        </view>
      </view>
    </block>
  </view>

  

  <view class="modal-overlay" wx:if="{{showAddEgg}}" bindtap="closeAddEggModal"></view>
  <view class="modal" wx:if="{{showAddEgg}}" catchtap="noop">
    <view class="modal-header">
      <text class="modal-title">添加蛋</text>
      <view class="modal-close" bindtap="closeAddEggModal">×</view>
    </view>
    <view class="modal-body">
      <view class="form-item">
        <text class="form-label">标签</text>
        <input class="form-input" placeholder="如 A1" value="{{form.label}}" bindinput="onInput" data-field="label" />
      </view>
      <view class="form-item">
        <text class="form-label">产蛋日期</text>
        <picker mode="date" value="{{form.laid_date}}" bindchange="onDateChange" data-field="laid_date">
          <view class="form-picker">{{form.laid_date || '请选择日期'}}</view>
        </picker>
      </view>
      <view class="form-item">
        <text class="form-label">开始孵化</text>
        <view class="picker-group">
          <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
            <view class="form-picker">{{startDate || '日期'}}</view>
          </picker>
          <picker mode="time" value="{{startTime}}" bindchange="onStartTimeChange">
            <view class="form-picker">{{startTime || '时间'}}</view>
          </picker>
        </view>
      </view>
      <view class="form-item">
        <text class="form-label">鹦鹉品种</text>
        <picker range="{{speciesNames}}" value="{{selectedSpeciesIndex}}" bindchange="onSpeciesChange">
          <view class="form-picker">{{selectedSpeciesIndex >= 0 ? speciesNames[selectedSpeciesIndex] : '请选择品种'}}</view>
        </picker>
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn-primary" bindtap="submitEgg">提交</button>
    </view>
  </view>
</view>
