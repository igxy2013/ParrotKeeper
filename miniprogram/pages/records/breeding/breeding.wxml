<!--pages/breeding/breeding.wxml-->
<view class="page-container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <app-header 
    title="ç¹æ®–è®°å½•" 
    subtitle="ä¸“ä¸šç¹æ®–ç®¡ç†åŠ©æ‰‹"
    showBack="{{true}}"
  >
    <view slot="actions" class="header-btn" bindtap="showAddForm">
      <image class="header-btn-icon-img" src="/images/remix/add-circle-fill.png" mode="widthFix" />
    </view>
  </app-header>

  <view class="page-content">
    <!-- æ¸¸å®¢æ¨¡å¼æç¤º -->
    <view wx:if="{{!isLogin}}" class="guest-tip">
      <text class="tip-text">ğŸ¥š ç¹æ®–è®°å½•åŠŸèƒ½éœ€è¦ç™»å½•ä½¿ç”¨</text>
      <text class="tip-subtitle">ç™»å½•åå¯ä»¥è®°å½•å’Œç®¡ç†æ‚¨çš„é¹¦é¹‰ç¹æ®–ä¿¡æ¯</text>
    </view>

    <!-- çŠ¶æ€ç­›é€‰ï¼ˆä¸å¥åº·é¡µé¢çš„è¿‡æ»¤å™¨ä¿æŒä¸€è‡´ï¼‰ -->
    <view wx:if="{{isLogin && canViewRecords}}" class="filter-section">
      <scroll-view class="chip-scroll" scroll-x="true">
        <view 
          class="chip {{selectedStatus === item ? 'active' : ''}}"
          wx:for="{{statusOptions}}" 
          wx:key="*this"
          bindtap="selectStatus"
          data-status="{{item}}"
        >
          <text class="option-text">{{item}}</text>
        </view>
      </scroll-view>
    </view>

    <!-- æ¦‚è§ˆç»Ÿè®¡ï¼ˆä¸å–‚é£Ÿé¡µé¢ç»Ÿè®¡å¡ç‰‡è®¾è®¡å¯¹é½ï¼‰ -->
    <view wx:if="{{isLogin && canViewRecords}}" class="summary-card rounded-3xl p-6 shadow-xl">
      <text class="summary-title text-lg font-bold">ç¹æ®–ç»Ÿè®¡</text>
      <view class="summary-grid summary-grid-2">
        <view class="summary-metric">
          <text class="summary-value text-2xl font-bold">{{stats.totalPairs}}</text>
          <text class="summary-label text-sm text-white-80">æ€»ç¹æ®–å¯¹æ•°</text>
        </view>
        <view class="summary-metric">
          <text class="summary-value text-2xl font-bold">{{stats.successfulHatching}}</text>
          <text class="summary-label text-sm text-white-80">æˆåŠŸå­µåŒ–</text>
        </view>
      </view>
    </view>

    <!-- ç¹æ®–è®°å½•åˆ—è¡¨ -->
    <!-- æœç´¢ä¸æ—¥æœŸç­›é€‰ï¼ˆä¸æ¸…æ´é¡µä¸€è‡´ï¼‰ -->
    <view wx:if="{{isLogin && canViewRecords}}" class="search-filter">
      <input class="search-input" placeholder="æœç´¢ï¼ˆé…å¯¹å/çŠ¶æ€/å¤‡æ³¨ï¼‰" value="{{searchQuery}}" bindinput="onSearchInput" confirm-type="search" />
      <view class="date-filter-row">
        <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
          <view class="date-picker">{{startDate || 'å¼€å§‹æ—¥æœŸ'}}</view>
        </picker>
        <text class="range-sep">â€”</text>
        <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
          <view class="date-picker">{{endDate || 'ç»“æŸæ—¥æœŸ'}}</view>
        </picker>
        <view class="clear-date" bindtap="clearDateFilter">æ¸…é™¤</view>
      </view>
    </view>
    <view wx:if="{{isLogin && canViewRecords}}" class="records-section">
      <scroll-view class="records-scroll" scroll-y="true" lower-threshold="50" bindscrolltolower="onListScrollLower">
      <view class="record-list" wx:if="{{filteredRecords.length > 0}}">
        <view 
          class="record-card" 
          wx:for="{{virtualDisplayRecords}}" 
          wx:key="id"
          bindtap="viewRecordDetail"
          data-type="breeding"
          data-id="{{item.id}}"
          data-record="{{item}}"
        >
          <view class="record-header">
            <view class="record-info">
              <text class="parrot-pair">{{item.parrotPair}}</text>
              <view class="status-badge {{item.statusClass}}">
                <text class="status-text">{{item.status}}</text>
              </view>
            </view>
            <view class="header-right">
              <view class="record-date">
                <text class="date-text">{{item.recordTime}}</text>
              </view>
              <view class="action-buttons">
                <view class="action-btn edit-btn" catchtap="editRecord" data-id="{{item.id}}">
                  <image class="action-icon-img" src="/images/remix/edit-line-white.png" mode="aspectFit" />
                </view>
                <view class="action-btn delete-btn" catchtap="deleteRecord" data-id="{{item.id}}">
                  <image class="action-icon-img" src="/images/remix/delete-bin-line-white.png" mode="aspectFit" />
                </view>
              </view>
            </view>
          </view>

          <view class="record-details">
            <view class="detail-grid">
              <view class="detail-item">
                <text class="detail-label">ç­‘å·¢æ—¥æœŸ</text>
                <text class="detail-value">{{item.nestingDate || '-'}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">äº§è›‹æ—¥æœŸ</text>
                <text class="detail-value">{{item.layingDate || '-'}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">å­µåŒ–æ—¥æœŸ</text>
                <text class="detail-value">{{item.hatchingDate || '-'}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">å­µåŒ–ç‡</text>
                <text class="detail-value">{{item.hatchingRate}}</text>
              </view>
            </view>
          </view>

          <view wx:if="{{item.notes}}" class="record-notes">
            <text class="notes-text">{{item.notes}}</text>
          </view>
        </view>
      </view>
      </scroll-view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{filteredRecords.length === 0 && !loading}}">
        <view class="empty-icon">ğŸ¥š</view>
        <view class="empty-text">æš‚æ— ç¹æ®–è®°å½•</view>
        <view class="empty-subtitle">å¼€å§‹è®°å½•æ‚¨çš„é¹¦é¹‰ç¹æ®–è¿‡ç¨‹</view>
        <view class="btn-primary" bindtap="showAddForm">æ·»åŠ ç¹æ®–è®°å½•</view>
      </view>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{loading}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
    </view>
  </view>


</view>
