<!--pages/records/feeding/feeding.wxml-->
<view class="min-h-screen bg-gradient-to-br from-orange-50 via-white to-yellow-50 pb-6">
  <!-- 通用头部组件 -->
  <app-header title="喂食记录" subtitle="记录每次喂食情况" showBack="{{true}}" theme="orange">
    <view slot="actions" class="header-btn" bindtap="showAddForm">
      <text class="header-btn-icon">+</text>
    </view>
  </app-header>

  <!-- Main Content -->
  <view class="pt-6 px-4 space-y-6">
    <!-- Filter Chips (aligned with health page design) -->
    <view class="filter-section">
      <scroll-view class="chip-scroll" scroll-x="true">
        <view
          bindtap="selectParrot"
          data-parrot="全部"
          class="chip {{selectedParrot === '全部' ? 'active' : ''}}"
        >
          <text>全部</text>
        </view>
        <view
          wx:for="{{parrots}}"
          wx:key="id"
          bindtap="selectParrot"
          data-parrot="{{item.name}}"
          class="chip {{selectedParrot === item.name ? 'active' : ''}}"
        >
          <text>{{item.name}}</text>
        </view>
      </scroll-view>
    </view>

    <!-- Today's Summary -->
    <view class="bg-gradient-header rounded-3xl p-6 text-white shadow-xl">
      <text class="text-lg font-bold mb-4 block">今日喂食统计</text>
      <view class="grid grid-cols-3 gap-4">
        <view class="text-center">
          <view class="text-2xl font-bold">{{todayStats.totalCount}}</view>
          <view class="text-white-80 text-sm">总次数</view>
        </view>
        <view class="text-center">
          <view class="text-2xl font-bold">{{todayStats.parrotCount}}</view>
          <view class="text-white-80 text-sm">鹦鹉数</view>
        </view>
        <view class="text-center">
          <view class="text-2xl font-bold">{{todayStats.totalAmount}}g</view>
          <view class="text-white-80 text-sm">总食量</view>
        </view>
      </view>
    </view>

    <!-- Feeding Records -->
    <view class="space-y-4">
      <view 
        wx:for="{{filteredRecords}}" 
        wx:key="id" 
        class="bg-white-80 backdrop-blur-sm rounded-2xl p-5 shadow-lg border border-white-50"
      >
        <view class="flex items-start space-x-4">
          <view class="w-12 h-12 rounded-full overflow-hidden bg-gray-100 flex-shrink-0">
            <image 
              src="{{item.parrot_avatar || '/images/default-parrot.png'}}" 
              class="w-full h-full object-cover"
              mode="aspectFill"
            />
          </view>
          <view class="flex-1">
            <view class="flex items-center justify-between mb-2">
              <view>
                <text class="font-semibold text-gray-800 block">{{item.parrot_names_display}}</text>
                <text class="text-xs text-gray-500">共{{item.parrot_count}}只鹦鹉</text>
              </view>
              <view class="text-right">
                <view class="text-sm font-medium text-gray-800">{{item.formatted_time}}</view>
                <view class="text-xs text-gray-500">{{item.formatted_date}}</view>
              </view>
            </view>
            <view class="bg-gradient-soft rounded-xl p-3 mb-3">
              <view class="flex items-center justify-between mb-2" wx:if="{{item.food_types.length === 1}}">
                <text class="text-sm font-medium text-gray-700">食物类型</text>
                <text class="text-sm text-orange-600 font-semibold">{{item.food_types[0].name}}</text>
              </view>
              <view class="flex items-center justify-between" wx:if="{{item.food_types.length === 1}}">
                <text class="text-sm font-medium text-gray-700">食用量</text>
                <text class="text-sm text-orange-600 font-semibold">{{item.food_types[0].amount}}g</text>
              </view>
              <!-- Multiple food types -->
              <view wx:if="{{item.food_types.length > 1}}">
                <text class="text-sm font-medium text-gray-700 block mb-2">食物类型</text>
                <view wx:for="{{item.food_types}}" wx:key="id" wx:for-item="food" class="flex items-center justify-between mb-1">
                  <text class="text-sm text-orange-600">{{food.name}}</text>
                  <text class="text-sm text-orange-600 font-semibold">{{food.amount}}g</text>
                </view>
              </view>
            </view>
            <view class="bg-gray-50 rounded-lg p-3" wx:if="{{item.notes}}">
              <text class="text-sm text-gray-600">{{item.notes}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>


</view>
