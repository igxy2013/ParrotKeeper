<!-- pages/records/cleaning/cleaning.wxml -->
<view class="cleaning-page">
  <!-- Header -->
  <view class="header" style="padding-right: {{menuRightPadding}}px;">
    <view class="header-left">
      <view class="back-btn" bindtap="goBack"><text class="back-icon">â†</text></view>
      <view class="title-wrap">
        <text class="title">æ¸…æ´è®°å½•</text>
        <text class="subtitle">é¹¦é¹‰æ¸…æ´æŠ¤ç†ç®¡ç†</text>
      </view>
    </view>
    <view class="header-right">
      <view class="add-btn" bindtap="addCleaningRecord"><text class="add-icon">ï¼‹</text></view>
    </view>
  </view>

  <!-- Content -->
  <scroll-view class="content" scroll-y="true">
    <!-- Stats Cards -->
    <view class="stats-grid">
      <view class="stat-card">
        <view class="stat-icon stat-blue">ğŸ“…</view>
        <text class="stat-value">{{stats.weeklyCount}}</text>
        <text class="stat-label">æœ¬å‘¨æ¸…æ´</text>
      </view>
      <view class="stat-card">
        <view class="stat-icon stat-green">ğŸ›¡ï¸</view>
        <text class="stat-value">{{stats.uniqueTypes}}</text>
        <text class="stat-label">æ¸…æ´ç±»å‹</text>
      </view>
      <view class="stat-card">
        <view class="stat-icon stat-purple">â±ï¸</view>
        <text class="stat-value">{{stats.lastTimeText || 'â€”'}}</text>
        <text class="stat-label">æœ€è¿‘ä¸€æ¬¡</text>
      </view>
    </view>

    <!-- Filter Tabs -->
    <view class="filter-tabs">
      <scroll-view scroll-x="true" class="filter-scroll">
        <view class="filter-row">
          <block wx:for="{{filterOptions}}" wx:key="*this">
            <view class="filter-chip {{selectedFilter === item ? 'active' : ''}}" bindtap="selectFilter" data-filter="{{item}}">
              <text class="chip-text">{{item}}</text>
            </view>
          </block>
        </view>
      </scroll-view>
    </view>

    <!-- Cleaning Records -->
    <view class="list" wx:if="{{displayRecords.length > 0}}">
      <block wx:for="{{displayRecords}}" wx:key="id">
        <view class="card">
          <view class="card-left">
            <image class="avatar" mode="cover" src="/images/default-parrot.png" />
          </view>
          <view class="card-right">
            <view class="card-head">
              <view class="info">
                <text class="name">{{item.parrot_name}}</text>
                <text class="type-badge">{{item.cleaning_type_text || item.cleaning_type}}</text>
              </view>
              <view class="time">{{item.cleaning_time_formatted}}</view>
            </view>

            <view class="card-body">
              <view class="detail" wx:if="{{item.description}}">
                <text class="label">æè¿°ï¼š</text>
                <text class="value">{{item.description}}</text>
              </view>
              <view class="detail" wx:if="{{item.notes}}">
                <text class="label">å¤‡æ³¨ï¼š</text>
                <text class="value">{{item.notes}}</text>
              </view>
              <view class="detail" wx:if="{{isTeamMode && item.created_by_username}}">
                <text class="label">è®°å½•è€…ï¼š</text>
                <text class="value">{{item.created_by_username}}</text>
              </view>
            </view>
          </view>
        </view>
      </block>
    </view>

    <!-- Empty State -->
    <view class="empty" wx:if="{{displayRecords.length === 0 && !loading}}">
      <view class="empty-icon">ğŸ§¹</view>
      <text class="empty-text" wx:if="{{isLogin}}">æš‚æ— {{selectedFilter}}è®°å½•</text>
      <text class="empty-text" wx:else>è¯·å…ˆç™»å½•æŸ¥çœ‹è®°å½•</text>
      <button class="btn btn-primary" wx:if="{{isLogin && hasOperationPermission}}" bindtap="addCleaningRecord">æ·»åŠ æ¸…æ´è®°å½•</button>
    </view>

    <view class="loading" wx:if="{{loading}}">åŠ è½½ä¸­...</view>
  </scroll-view>
</view>
