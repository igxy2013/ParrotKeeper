<!--pages/records/add-record/add-record.wxml-->
<view class="page-container" bindtouchstart="touchStart" bindtouchend="touchEnd">
  <!-- ä½¿ç”¨é¡¹ç›®é€šç”¨é¡¶éƒ¨å¯¼èˆªç»„ä»¶ -->
  <app-header title="{{(recordId ? 'ç¼–è¾‘' : 'æ·»åŠ ') + (recordType === 'feeding' ? 'å–‚é£Ÿ' : recordType === 'cleaning' ? 'æ¸…æ´' : recordType === 'health' ? 'å¥åº·' : recordType === 'breeding' ? 'ç¹æ®–' : '') + 'è®°å½•'}}" subtitle="è®°å½•é¹¦é¹‰çš„æ—¥å¸¸æŠ¤ç†" showBack="{{true}}" theme="{{navTheme}}">
  </app-header>

  <view class="form-content">
    <form bindsubmit="submitForm">
      <!-- è®°å½•ç±»å‹ -->
      <view class="form-section">
        <view class="section-title">è®°å½•ç±»å‹</view>
        
        <view class="type-selector">
          <!-- åŠ¨æ€æ»‘å— -->
          <view class="type-cursor {{recordType}}" style="left: {{recordType === 'feeding' ? '2%' : recordType === 'cleaning' ? '27%' : recordType === 'health' ? '52%' : '77%'}}"></view>
          
          <view 
            class="type-item {{recordType === 'feeding' ? 'active' : ''}}"
            bindtap="selectType"
            data-type="feeding"
          >
            <image class="type-icon-img" src="/images/remix/ri-restaurant-fill-orange.png" mode="aspectFit"></image>
            <text class="type-text">å–‚é£Ÿ</text>
          </view>
          <view 
            class="type-item {{recordType === 'cleaning' ? 'active' : ''}}"
            bindtap="selectType"
            data-type="cleaning"
          >
            <image class="type-icon-img" src="/images/remix/ri-calendar-fill-blue.png" mode="aspectFit"></image>
            <text class="type-text">æ¸…æ´</text>
          </view>
          <view 
            class="type-item {{recordType === 'health' ? 'active' : ''}}"
            bindtap="selectType"
            data-type="health"
          >
            <image class="type-icon-img" src="/images/remix/ri-heart-fill-purple.png" mode="aspectFit"></image>
            <text class="type-text">å¥åº·</text>
          </view>
          <view 
            class="type-item {{recordType === 'breeding' ? 'active' : ''}}"
            bindtap="selectType"
            data-type="breeding"
          >
            <image class="type-icon-img" src="/images/remix/ri-book-fill-green.png" mode="aspectFit"></image>
            <text class="type-text">ç¹æ®–</text>
          </view>
        </view>
      </view>

      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <view class="form-section">
        <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
        
        <view class="form-item">
          <text class="form-label required">é€‰æ‹©é¹¦é¹‰</text>
          <view class="form-picker" bindtap="showParrotPicker">
            <text class="picker-text {{formData.parrot_ids.length > 0 ? '' : 'placeholder'}}">
              {{selectedParrotNames || (recordType === 'health' ? 'è¯·é€‰æ‹©é¹¦é¹‰ï¼ˆå•é€‰ï¼‰' : 'è¯·é€‰æ‹©é¹¦é¹‰ï¼ˆå¯å¤šé€‰ï¼‰')}}
            </text>
            <image class="picker-arrow-img" src="/images/remix/ri-arrow-down-s-fill-gray.png" mode="aspectFit"></image>
          </view>
        </view>
        
        <view class="form-item">
          <text class="form-label required">è®°å½•æ—¶é—´</text>
          <view class="datetime-picker">
            <picker 
              mode="date" 
              value="{{formData.record_date}}" 
              bindchange="onDateChange"
              end="{{today}}"
            >
              <view class="picker-item">
                <text class="picker-text {{formData.record_date ? '' : 'placeholder'}}">
                  {{formData.record_date || 'é€‰æ‹©æ—¥æœŸ'}}
                </text>
              </view>
            </picker>
            <picker 
              mode="time" 
              value="{{formData.record_time}}" 
              bindchange="onTimeChange"
            >
              <view class="picker-item">
                <text class="picker-text {{formData.record_time ? '' : 'placeholder'}}">
                  {{formData.record_time || 'é€‰æ‹©æ—¶é—´'}}
                </text>
                <image class="picker-arrow-img" src="/images/remix/ri-arrow-down-s-fill-gray.png" mode="aspectFit"></image>
              </view>
            </picker>
          </view>
      </view>
    </view>

    

    <!-- å–‚é£Ÿè®°å½•ç‰¹æœ‰å­—æ®µ -->
    <view class="form-section" wx:if="{{recordType === 'feeding'}}">
      <view class="section-title">
        <image class="section-icon" src="/images/remix/ri-restaurant-fill-orange.png" />
        <text>å–‚é£Ÿè¯¦æƒ…</text>
      </view>
        
        <view class="form-item">
          <text class="form-label required">é£Ÿç‰©ç±»å‹</text>
          <view class="form-picker" bindtap="showFeedTypePicker">
            <text class="picker-text {{selectedFeedTypeNames ? '' : 'placeholder'}}">
              {{selectedFeedTypeNames || 'é€‰æ‹©é£Ÿç‰©ç±»å‹ï¼ˆå¯å¤šé€‰ï¼‰'}}
            </text>
            <image class="picker-arrow-img" src="/images/remix/ri-arrow-down-s-fill-gray.png" mode="aspectFit"></image>
          </view>
        </view>
      
      <!-- å½“é€‰æ‹© 0 æˆ– 1 ä¸ªé£Ÿç‰©ç±»å‹æ—¶ï¼Œä½¿ç”¨å•ä¸ªé£Ÿç‰©é‡è¾“å…¥ -->
      <view class="form-item" wx:if="{{formData.food_types.length <= 1}}">
        <text class="form-label required">é£Ÿç‰©é‡ ({{amountUnit}})</text>
        <view 
          class="form-input input-view {{formData.amount ? '' : 'placeholder'}}" 
          bindtap="showKeyboard" 
          data-field="amount" 
          data-title="é£Ÿç‰©{{amountUnit === 'ml' ? 'å®¹é‡' : 'é‡é‡'}}"
          data-type="digit"
        >
          {{formData.amount || 'è¯·è¾“å…¥é£Ÿç‰©' + (amountUnit === 'ml' ? 'å®¹é‡' : 'é‡é‡')}}
        </view>
      </view>

      <!-- å½“é€‰æ‹©å¤šä¸ªé£Ÿç‰©ç±»å‹æ—¶ï¼Œåˆ†åˆ«å±•ç¤ºæ¯ä¸ªç±»å‹çš„é£Ÿç‰©é‡è¾“å…¥ -->
      <view class="form-item" wx:if="{{formData.food_types.length > 1}}">
        <text class="form-label required">å„é£Ÿç‰©ç±»å‹çš„é£Ÿç‰©é‡</text>
        <block wx:for="{{selectedFeedTypes}}" wx:key="id">
          <view class="form-item">
            <text class="form-label">{{item.name}} ({{((item.type === 'milk_powder' || item.type === 'supplement') && item.name.indexOf('åšæœ') === -1) ? 'ml' : 'g'}})</text>
            <view 
              class="form-input input-view {{(formData.food_amounts && formData.food_amounts[item.id]) ? '' : 'placeholder'}}" 
              bindtap="showKeyboard" 
              data-field="food_amounts" 
              data-id="{{item.id}}"
              data-title="{{item.name}}{{((item.type === 'milk_powder' || item.type === 'supplement') && item.name.indexOf('åšæœ') === -1) ? 'å®¹é‡' : 'é‡é‡'}}"
              data-type="digit"
            >
              {{(formData.food_amounts && formData.food_amounts[item.id]) || 'è¯·è¾“å…¥' + item.name + (((item.type === 'milk_powder' || item.type === 'supplement') && item.name.indexOf('åšæœ') === -1) ? 'å®¹é‡' : 'é‡é‡')}}
            </view>
          </view>
        </block>
      </view>
    </view>

    <!-- æ¸…æ´è®°å½•ç‰¹æœ‰å­—æ®µ -->
    <view class="form-section" wx:if="{{recordType === 'cleaning'}}">
      <view class="section-title">
        <image class="section-icon" src="/images/remix/ri-calendar-fill-blue.png" />
        <text>æ¸…æ´è¯¦æƒ…</text>
      </view>
      
      <view class="form-item">
        <text class="form-label required">æ¸…æ´ç±»å‹</text>
        <view class="form-picker" bindtap="showCleaningTypePicker">
          <text class="picker-text {{selectedCleaningTypeNames ? '' : 'placeholder'}}">
            {{selectedCleaningTypeNames || 'è¯·é€‰æ‹©æ¸…æ´ç±»å‹'}}
          </text>
          <image class="picker-arrow-img" src="/images/remix/ri-arrow-down-s-fill-gray.png" mode="aspectFit"></image>
        </view>
      </view>
      
      <view class="form-item">
        <text class="form-label">æ¸…æ´æè¿°</text>
        <block wx:if="{{!showCleaningTypeModal && !showFeedTypeModal && !showParrotModal && !showMaleParrotModal && !showFemaleParrotModal && !showHealthStatusModal && !keyboardVisible}}">
          <textarea 
            class="form-textarea" 
            placeholder="è¯·è¾“å…¥æ¸…æ´çš„è¯¦ç»†æè¿°" 
            value="{{formData.description}}"
            bindinput="onInputChange"
            data-field="description"
            maxlength="500"
          />
        </block>
        <view wx:else class="form-textarea" style="color: {{formData.description ? '#111827' : '#9ca3af'}};">
          {{formData.description || 'è¯·è¾“å…¥æ¸…æ´çš„è¯¦ç»†æè¿°'}}
        </view>
      </view>
    </view>

    <!-- å¥åº·æ£€æŸ¥ç‰¹æœ‰å­—æ®µ -->
    <view class="form-section" wx:if="{{recordType === 'health'}}">
      <view class="section-title">
        <image class="section-icon" src="/images/remix/ri-heart-fill-purple.png" />
        <text>å¥åº·è¯¦æƒ…</text>
      </view>
      
      <view class="form-item">
        <text class="form-label">ä½“é‡ (g)</text>
        <view 
          class="form-input input-view {{formData.weight ? '' : 'placeholder'}}" 
          bindtap="showKeyboard" 
          data-field="weight" 
          data-title="å½“å‰ä½“é‡"
          data-type="digit"
        >
          {{formData.weight || 'è¯·è¾“å…¥å½“å‰ä½“é‡'}}
        </view>
      </view>
      

      
      <view class="form-item">
        <text class="form-label">å¥åº·çŠ¶æ€</text>
        <view class="form-picker" bindtap="showHealthStatusPicker">
          <text class="picker-text {{formData.health_status ? '' : 'placeholder'}}">
            {{healthStatusText || 'è¯·é€‰æ‹©å¥åº·çŠ¶æ€'}}
          </text>
          <image class="picker-arrow-img" src="/images/remix/ri-arrow-down-s-fill-gray.png" mode="aspectFit"></image>
        </view>
      </view>
    </view>

    <!-- ç¹æ®–è®°å½•ç‰¹æœ‰å­—æ®µ -->
    <view class="form-section" wx:if="{{recordType === 'breeding'}}">
      <view class="section-title">
        <image class="section-icon" src="/images/remix/ri-book-fill-green.png" />
        <text>ç¹æ®–è¯¦æƒ…</text>
      </view>
      
      <view class="form-item">
        <text class="form-label required">é›„æ€§é¹¦é¹‰</text>
        <view class="form-picker" bindtap="showMaleParrotPicker">
          <text class="picker-text {{formData.male_parrot_id ? '' : 'placeholder'}}">
            {{selectedMaleParrotName || 'è¯·é€‰æ‹©é›„æ€§é¹¦é¹‰'}}
          </text>
          <image class="picker-arrow-img" src="/images/remix/ri-arrow-down-s-fill-gray.png" mode="aspectFit"></image>
        </view>
      </view>
      
      <view class="form-item">
        <text class="form-label required">é›Œæ€§é¹¦é¹‰</text>
        <view class="form-picker" bindtap="showFemaleParrotPicker">
          <text class="picker-text {{formData.female_parrot_id ? '' : 'placeholder'}}">
            {{selectedFemaleParrotName || 'è¯·é€‰æ‹©é›Œæ€§é¹¦é¹‰'}}
          </text>
          <image class="picker-arrow-img" src="/images/remix/ri-arrow-down-s-fill-gray.png" mode="aspectFit"></image>
        </view>
      </view>
      
      <view class="form-item">
        <text class="form-label required">äº¤é…æ—¥æœŸ</text>
        <picker 
          mode="date" 
          value="{{formData.mating_date}}" 
          bindchange="onMatingDateChange"
          end="{{today}}"
        >
          <view class="picker-item">
            <text class="picker-text {{formData.mating_date ? '' : 'placeholder'}}">
              {{formData.mating_date || 'é€‰æ‹©äº¤é…æ—¥æœŸ'}}
            </text>
          </view>
        </picker>
      </view>
      
      <view class="form-item">
        <text class="form-label">äº§è›‹æ—¥æœŸ</text>
        <picker 
          mode="date" 
          value="{{formData.egg_laying_date}}" 
          bindchange="onEggLayingDateChange"
          end="{{today}}"
        >
          <view class="picker-item">
            <text class="picker-text {{formData.egg_laying_date ? '' : 'placeholder'}}">
              {{formData.egg_laying_date || 'é€‰æ‹©äº§è›‹æ—¥æœŸ'}}
            </text>
          </view>
        </picker>
      </view>
      
      <view class="form-item">
        <text class="form-label">è›‹æ•°é‡</text>
        <view 
          class="form-input input-view {{formData.egg_count ? '' : 'placeholder'}}" 
          bindtap="showKeyboard" 
          data-field="egg_count" 
          data-title="è›‹çš„æ•°é‡"
          data-type="integer"
        >
          {{formData.egg_count || 'è¯·è¾“å…¥è›‹çš„æ•°é‡'}}
        </view>
      </view>
      
      <view class="form-item">
        <text class="form-label">å­µåŒ–æ—¥æœŸ</text>
        <picker 
          mode="date" 
          value="{{formData.hatching_date}}" 
          bindchange="onHatchingDateChange"
          end="{{today}}"
        >
          <view class="picker-item">
            <text class="picker-text {{formData.hatching_date ? '' : 'placeholder'}}">
              {{formData.hatching_date || 'é€‰æ‹©å­µåŒ–æ—¥æœŸ'}}
            </text>
          </view>
        </picker>
      </view>
      
      <view class="form-item">
        <text class="form-label">å¹¼é¸Ÿæ•°é‡</text>
        <view 
          class="form-input input-view {{formData.chick_count ? '' : 'placeholder'}}" 
          bindtap="showKeyboard" 
          data-field="chick_count" 
          data-title="å¹¼é¸Ÿæ•°é‡"
          data-type="integer"
        >
          {{formData.chick_count || 'è¯·è¾“å…¥æˆåŠŸå­µåŒ–çš„å¹¼é¸Ÿæ•°é‡'}}
        </view>
      </view>
      
      <view class="form-item">
        <text class="form-label">æˆåŠŸç‡ (%)</text>
        <view 
          class="form-input input-view {{formData.success_rate ? '' : 'placeholder'}}" 
          bindtap="showKeyboard" 
          data-field="success_rate" 
          data-title="ç¹æ®–æˆåŠŸç‡"
          data-type="digit"
        >
          {{formData.success_rate || 'è¯·è¾“å…¥ç¹æ®–æˆåŠŸç‡'}}
        </view>
      </view>
    </view>

    <!-- ç…§ç‰‡ä¸Šä¼  -->
    <view class="form-section">
      <view class="section-title">
        <image class="section-icon" src="/images/remix/ri-camera-fill-pink.png" />
        <text>è®°å½•ç…§ç‰‡ (å¯é€‰)</text>
      </view>
      
      <view class="photo-upload">
        <view class="photo-list" wx:if="{{formData.photos.length > 0}}">
          <view 
            class="photo-item" 
            wx:for="{{formData.photos}}" 
            wx:key="*this"
          >
            <image 
              class="photo-image" 
              src="{{item}}" 
              mode="aspectFill"
              bindtap="previewPhoto"
              data-url="{{item}}"
            />
            <view 
              class="photo-delete" 
              bindtap="deletePhoto"
              data-index="{{index}}"
            >
              <image class="photo-delete-icon" src="/images/remix/delete-bin-line-gray.png" mode="aspectFit"></image>
            </view>
          </view>
          
          <view 
            class="add-photo-btn" 
            wx:if="{{formData.photos.length < 3}}"
            bindtap="choosePhoto"
          >
            <image class="add-photo-icon" src="/images/remix/ri-add-fill-emerald.png" mode="aspectFit"></image>
          </view>
        </view>
        
        <view class="upload-area" wx:else bindtap="choosePhoto">
          <image class="upload-icon-img" src="/images/remix/ri-camera-line-gray.png" mode="aspectFit"></image>
          <text class="upload-text">æ·»åŠ ç…§ç‰‡</text>
          <text class="upload-tip">æœ€å¤šå¯æ·»åŠ 3å¼ ç…§ç‰‡</text>
        </view>
      </view>
    </view>

    <!-- å¤‡æ³¨ä¿¡æ¯ -->
    <view class="form-section">
      <view class="section-title">å¤‡æ³¨ä¿¡æ¯</view>
      
      <view class="form-item">
        <text class="form-label">å¤‡æ³¨</text>
        <block wx:if="{{!showCleaningTypeModal && !showFeedTypeModal && !showParrotModal && !showMaleParrotModal && !showFemaleParrotModal && !showHealthStatusModal && !keyboardVisible}}">
          <textarea 
            class="form-textarea" 
            placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰" 
            value="{{formData.notes}}"
            bindinput="onInputChange"
            data-field="notes"
            maxlength="500"
            show-confirm-bar="{{false}}"
          />
        </block>
        <view wx:else class="form-textarea" style="color: {{formData.notes ? '#111827' : '#9ca3af'}};">
          {{formData.notes || 'è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰'}}
        </view>
        <view class="char-count">{{formData.notes.length}}/500</view>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="form-actions">
      <button class="btn btn-secondary" bindtap="goBack">å–æ¶ˆ</button>
      <button 
        class="btn btn-primary {{submitting ? 'loading' : ''}}" 
        formType="submit"
        disabled="{{!canSubmit || submitting}}"
      >
        {{submitting ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜è®°å½•'}}
      </button>
    </view>
  </form>
</view>

<!-- é¹¦é¹‰é€‰æ‹©å¼¹çª— -->
<view class="modal-overlay bottom-sheet" wx:if="{{showParrotModal}}" bindtap="hideParrotPicker" catchtouchmove="preventTouchMove">
  <view class="modal-content bottom-sheet-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©é¹¦é¹‰</text>
      <view class="modal-close" bindtap="hideParrotPicker">Ã—</view>
    </view>
    <scroll-view scroll-y="true" class="modal-body">
      <!-- å¥åº·è®°å½•ï¼šå•é€‰ -->
      <radio-group wx:if="{{recordType === 'health'}}" bindchange="onParrotRadioChange">
        <label class="parrot-item {{item.selected ? 'selected' : ''}}" wx:for="{{parrotList}}" wx:key="id">
          <view class="parrot-left">
            <view class="parrot-avatar">
              <image class="parrot-image" src="{{item.thumb_url || item.photo_url || item.avatar_url || '/images/default-parrot.png'}}" mode="aspectFill" />
            </view>
            <view class="parrot-info">
              <view class="name-section">
                <text class="parrot-name">{{item.name}}</text>
                <text class="parrot-gender {{item.gender}}">{{item.gender === 'male' ? 'â™‚' : item.gender === 'female' ? 'â™€' : 'ï¼Ÿ'}}</text>
              </view>
              <text class="parrot-species">{{item.species_name}}</text>
            </view>
            <view class="status-pills">
              <view class="status-pill pill-{{item.current_health_status || 'healthy'}}">
                <text class="pill-icon">{{(item.current_health_status || 'healthy') === 'healthy' ? 'âœ“' : (item.current_health_status || 'healthy') === 'sick' ? '!' : (item.current_health_status || 'healthy') === 'recovering' ? 'â†—' : 'ğŸ‘'}}</text>
                <text class="pill-text">{{(item.current_health_status || 'healthy') === 'healthy' ? 'å¥åº·' : (item.current_health_status || 'healthy') === 'sick' ? 'ç”Ÿç—…' : (item.current_health_status || 'healthy') === 'recovering' ? 'åº·å¤ä¸­' : 'è§‚å¯Ÿä¸­'}}</text>
              </view>
            </view>
          </view>
          <view class="parrot-right">
            <radio class="parrot-radio" value="{{item.id}}" checked="{{item.selected}}" />
            <image class="check-icon-img" wx:if="{{item.selected}}" src="{{checkIconSrc}}" mode="aspectFit" />
          </view>
        </label>
      </radio-group>

      <!-- å…¶ä»–è®°å½•ç±»å‹ï¼šå¤šé€‰ -->
      <checkbox-group wx:else bindchange="onParrotChange">
        <label class="parrot-item {{item.selected ? 'selected' : ''}}" wx:for="{{parrotList}}" wx:key="id">
          <view class="parrot-left">
            <view class="parrot-avatar">
              <image class="parrot-image" src="{{item.thumb_url || item.photo_url || item.avatar_url || '/images/default-parrot.png'}}" mode="aspectFill" />
            </view>
            <view class="parrot-info">
              <view class="name-section">
                <text class="parrot-name">{{item.name}}</text>
                <text class="parrot-gender {{item.gender}}">{{item.gender === 'male' ? 'â™‚' : item.gender === 'female' ? 'â™€' : 'ï¼Ÿ'}}</text>
              </view>
              <text class="parrot-species">{{item.species_name}}</text>
            </view>
            <view class="status-pills">
              <view class="status-pill pill-{{item.current_health_status || 'healthy'}}">
                <text class="pill-icon">{{(item.current_health_status || 'healthy') === 'healthy' ? 'âœ“' : (item.current_health_status || 'healthy') === 'sick' ? '!' : (item.current_health_status || 'healthy') === 'recovering' ? 'â†—' : 'ğŸ‘'}}</text>
                <text class="pill-text">{{(item.current_health_status || 'healthy') === 'healthy' ? 'å¥åº·' : (item.current_health_status || 'healthy') === 'sick' ? 'ç”Ÿç—…' : (item.current_health_status || 'healthy') === 'recovering' ? 'åº·å¤ä¸­' : 'è§‚å¯Ÿä¸­'}}</text>
              </view>
            </view>
          </view>
          <view class="parrot-right">
            <checkbox class="parrot-checkbox" value="{{item.id}}" checked="{{item.selected}}" />
            <image class="check-icon-img" wx:if="{{item.selected}}" src="{{checkIconSrc}}" mode="aspectFit" />
          </view>
        </label>
      </checkbox-group>
    </scroll-view>
    <view class="modal-footer" wx:if="{{recordType !== 'health'}}">
      <button class="confirm-btn" bindtap="confirmParrotSelection">ç¡®å®š</button>
    </view>
  </view>
</view>

<!-- æ¸…æ´ç±»å‹é€‰æ‹©å™¨æ¨¡æ€æ¡† -->
<view class="modal-overlay bottom-sheet" wx:if="{{showCleaningTypeModal}}" bindtap="hideCleaningTypePicker" catchtouchmove="preventTouchMove">
  <view class="modal-content bottom-sheet-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©æ¸…æ´ç±»å‹</text>
      <view class="modal-close" bindtap="hideCleaningTypePicker">Ã—</view>
    </view>
    <scroll-view scroll-y="true" class="modal-body">
      <checkbox-group class="cleaning-type-grid" bindchange="onCleaningTypeChange">
        <label class="cleaning-type-item {{item.selected ? 'selected' : ''}}" wx:for="{{cleaningTypeList}}" wx:key="id">
          <view class="cleaning-content">
            <text class="cleaning-type-name">{{item.name}}</text>
          </view>
          <view class="checkbox-wrapper">
             <checkbox class="cleaning-checkbox" value="{{item.id}}" checked="{{item.selected}}" />
             <image class="check-icon-img" wx:if="{{item.selected}}" src="{{checkIconSrc}}" mode="aspectFit" />
          </view>
        </label>
      </checkbox-group>
    </scroll-view>
    <view class="modal-footer">
      <button class="confirm-btn" bindtap="confirmCleaningTypeSelection">ç¡®å®š</button>
    </view>
  </view>
</view>

<!-- é£Ÿç‰©ç±»å‹é€‰æ‹©å™¨æ¨¡æ€æ¡† -->
<view class="modal-overlay bottom-sheet" wx:if="{{showFeedTypeModal}}" bindtap="hideFeedTypePicker" catchtouchmove="preventTouchMove">
  <view class="modal-content bottom-sheet-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©é£Ÿç‰©ç±»å‹</text>
      <view class="modal-close" bindtap="hideFeedTypePicker">Ã—</view>
    </view>
    <scroll-view scroll-y="true" class="modal-body">
      <view class="feed-type-list">
        <view 
          class="feed-type-item {{item.selected ? 'selected' : ''}}" 
          wx:for="{{feedTypeList}}" 
          wx:key="id"
          bindtap="selectFeedType"
          data-id="{{item.id}}"
          data-name="{{item.displayName || item.name}}"
        >
          <view class="feed-type-icon-wrapper">
             <image class="feed-type-icon" src="/images/remix/ri-restaurant-fill-orange.png" mode="aspectFit"></image>
          </view>
          <view class="feed-type-info">
            <text class="feed-type-name">{{item.displayName || item.name}}</text>
            <view class="feed-type-details">
              <text class="feed-type-brand" wx:if="{{item.brand}}">{{item.brand}}</text>
              <text class="feed-type-type" wx:if="{{item.typeText}}">{{item.typeText}}</text>
            </view>
          </view>
          <view class="selection-indicator" wx:if="{{item.selected}}">âœ“</view>
        </view>
      </view>
    </scroll-view>
    <view class="modal-footer">
      <button class="confirm-btn" bindtap="confirmFeedTypeSelection">ç¡®å®š</button>
    </view>
  </view>
</view>

<!-- å¥åº·çŠ¶æ€é€‰æ‹©å¼¹çª— -->
<view class="modal-overlay bottom-sheet" wx:if="{{showHealthStatusModal}}" bindtap="hideHealthStatusPicker" catchtouchmove="preventTouchMove">
  <view class="modal-content bottom-sheet-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©å¥åº·çŠ¶æ€</text>
      <view class="modal-close" bindtap="hideHealthStatusPicker">Ã—</view>
    </view>
    <scroll-view scroll-y="true" class="modal-body">
      <radio-group class="status-list" bindchange="onHealthStatusChange">
        <label class="status-item">
          <view class="status-left">
            <view class="status-indicator healthy"></view>
            <text class="status-text">å¥åº·</text>
          </view>
          <radio class="status-radio" value="healthy" checked="{{formData.health_status === 'healthy'}}" />
        </label>
        <label class="status-item">
          <view class="status-left">
            <view class="status-indicator sick"></view>
            <text class="status-text">ç”Ÿç—…</text>
          </view>
          <radio class="status-radio" value="sick" checked="{{formData.health_status === 'sick'}}" />
        </label>
        <label class="status-item">
          <view class="status-left">
            <view class="status-indicator recovering"></view>
            <text class="status-text">åº·å¤ä¸­</text>
          </view>
          <radio class="status-radio" value="recovering" checked="{{formData.health_status === 'recovering'}}" />
        </label>
        <label class="status-item">
          <view class="status-left">
            <view class="status-indicator observation"></view>
            <text class="status-text">è§‚å¯Ÿä¸­</text>
          </view>
          <radio class="status-radio" value="observation" checked="{{formData.health_status === 'observation'}}" />
        </label>
      </radio-group>
    </scroll-view>
  </view>
</view>

<!-- é›„æ€§é¹¦é¹‰é€‰æ‹©å¼¹çª— -->
<view class="modal-overlay bottom-sheet" wx:if="{{showMaleParrotModal}}" bindtap="hideMaleParrotPicker" catchtouchmove="preventTouchMove">
  <view class="modal-content bottom-sheet-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©é›„æ€§é¹¦é¹‰</text>
      <text class="modal-close" bindtap="hideMaleParrotPicker">Ã—</text>
    </view>
    <scroll-view scroll-y="true" class="modal-body">
      <view class="parrot-list">
        <view 
          class="parrot-item" 
          wx:for="{{maleParrotList}}" 
          wx:key="id"
          data-id="{{item.id}}"
          data-name="{{item.name}}"
          bindtap="selectMaleParrot"
        >
          <view class="parrot-avatar">
            <image class="parrot-image" src="{{item.thumb_url || item.photo_url || item.avatar_url || '/images/default-parrot.png'}}" mode="aspectFill" />
          </view>
          <view class="parrot-info">
            <view class="name-section">
              <text class="parrot-name">{{item.name}}</text>
              <text class="parrot-gender {{item.gender}}">{{item.gender === 'male' ? 'â™‚' : item.gender === 'female' ? 'â™€' : 'ï¼Ÿ'}}</text>
            </view>
            <text class="parrot-species">{{item.species_name}}</text>
          </view>
          <view class="status-pills">
            <view class="status-pill pill-{{item.current_health_status || 'healthy'}}">
              <text class="pill-icon">{{(item.current_health_status || 'healthy') === 'healthy' ? 'âœ“' : (item.current_health_status || 'healthy') === 'sick' ? '!' : (item.current_health_status || 'healthy') === 'recovering' ? 'â†—' : 'ğŸ‘'}}</text>
              <text class="pill-text">{{(item.current_health_status || 'healthy') === 'healthy' ? 'å¥åº·' : (item.current_health_status || 'healthy') === 'sick' ? 'ç”Ÿç—…' : (item.current_health_status || 'healthy') === 'recovering' ? 'åº·å¤ä¸­' : 'è§‚å¯Ÿä¸­'}}</text>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
</view>

<!-- æ•°å­—é”®ç›˜ -->
<numeric-keyboard
  visible="{{keyboardVisible}}"
  value="{{keyboardValue}}"
  maxLength="{{keyboardMaxLength}}"
  maxDecimals="{{keyboardMaxDecimals}}"
  title="{{keyboardTitle}}"
  bind:input="onKeyboardInput"
  bind:confirm="onKeyboardConfirm"
  bind:close="onKeyboardClose"
/>
</view>

<!-- é›Œæ€§é¹¦é¹‰é€‰æ‹©å¼¹çª— -->
<view class="modal-overlay bottom-sheet" wx:if="{{showFemaleParrotModal}}" bindtap="hideFemaleParrotPicker" catchtouchmove="preventTouchMove">
  <view class="modal-content bottom-sheet-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©é›Œæ€§é¹¦é¹‰</text>
      <text class="modal-close" bindtap="hideFemaleParrotPicker">Ã—</text>
    </view>
    <scroll-view scroll-y="true" class="modal-body">
      <view class="parrot-list">
        <view 
          class="parrot-item" 
          wx:for="{{femaleParrotList}}" 
          wx:key="id"
          data-id="{{item.id}}"
          data-name="{{item.name}}"
          bindtap="selectFemaleParrot"
        >
          <view class="parrot-avatar">
            <image class="parrot-image" src="{{item.thumb_url || item.photo_url || item.avatar_url || '/images/default-parrot.png'}}" mode="aspectFill" />
          </view>
          <view class="parrot-info">
            <view class="name-section">
              <text class="parrot-name">{{item.name}}</text>
              <text class="parrot-gender {{item.gender}}">{{item.gender === 'male' ? 'â™‚' : item.gender === 'female' ? 'â™€' : 'ï¼Ÿ'}}</text>
            </view>
            <text class="parrot-species">{{item.species_name}}</text>
          </view>
          <view class="status-pills">
            <view class="status-pill pill-{{item.current_health_status || 'healthy'}}">
              <text class="pill-icon">{{(item.current_health_status || 'healthy') === 'healthy' ? 'âœ“' : (item.current_health_status || 'healthy') === 'sick' ? '!' : (item.current_health_status || 'healthy') === 'recovering' ? 'â†—' : 'ğŸ‘'}}</text>
              <text class="pill-text">{{(item.current_health_status || 'healthy') === 'healthy' ? 'å¥åº·' : (item.current_health_status || 'healthy') === 'sick' ? 'ç”Ÿç—…' : (item.current_health_status || 'healthy') === 'recovering' ? 'åº·å¤ä¸­' : 'è§‚å¯Ÿä¸­'}}</text>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
</view>
