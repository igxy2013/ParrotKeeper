<view class="plumage-selector">
  <view class="selector-card {{gender}} {{compact ? 'compact' : ''}}" bindtap="openSelector">
    <view class="card-header">
      <view class="header-left">
        <image class="gender-icon" src="{{gender === 'male' ? '/images/remix/men-line.png' : '/images/remix/women-line.png'}}" mode="widthFix" />
        <text class="label">{{label}}</text>
      </view>
      <view class="edit-hint">点击选择</view>
    </view>
    
    <view class="card-content">
      <view class="main-color">{{colors[colorIndex] || '未选择'}}</view>
      <view class="splits-tags" wx:if="{{selectedSplitsDisplay.length > 0}}">
        <view class="split-tag" wx:for="{{selectedSplitsDisplay}}" wx:key="*this">{{item}}</view>
      </view>
      <view class="splits-placeholder" wx:else>无携带基因</view>
    </view>

    <slot name="suggestion"></slot>
  </view>

  <!-- Popup / Bottom Sheet -->
  <view class="mask {{visible ? 'visible' : ''}}" bindtap="closeSelector" catchtouchmove="preventTouchMove"></view>
  <view class="popup {{visible ? 'visible' : ''}}" catchtouchmove="preventTouchMove">
    <view class="popup-header">
      <text class="popup-title">选择{{label}}基因</text>
      <view class="close-btn" bindtap="closeSelector">✕</view>
    </view>
    
    <scroll-view scroll-y class="popup-content">
      <!-- Section 1: Main Color -->
      <view class="section">
        <view class="section-title">羽色 (Visual)</view>
        <view class="search-row">
          <input 
            class="search-input" 
            placeholder="搜索羽色，例如：蓝和尚" 
            value="{{searchKeyword}}" 
            bindinput="onSearchInput" 
          />
          <view 
            class="clear-btn" 
            wx:if="{{searchKeyword}}" 
            bindtap="clearSearch"
          >清除</view>
        </view>
        <view class="options-grid">
          <view 
            wx:for="{{renderColors}}" 
            wx:key="index" 
            class="option-chip {{tempColorIndex === item.index ? 'active' : ''}}"
            data-index="{{item.index}}"
            bindtap="selectColor"
          >
            {{item.name}}
          </view>
        </view>
      </view>

      <!-- Section 2: Splits -->
      <view class="section" wx:if="{{localSplits && localSplits.length > 0}}">
        <view class="section-title">携带 (Splits)</view>
        <view class="options-grid">
          <view 
            wx:for="{{localSplits}}" 
            wx:key="id" 
            class="option-chip {{item.checked ? 'active-split' : ''}}"
            data-id="{{item.id}}"
            bindtap="toggleSplit"
          >
            {{item.name}}
          </view>
        </view>
      </view>
    </scroll-view>

    <view class="popup-footer">
      <button class="confirm-btn" bindtap="confirmSelection">确认选择</button>
    </view>
  </view>
</view>
