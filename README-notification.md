# 通知功能配置说明

## 概述

鹦鹉管家的通知功能支持两种类型的通知：
1. **本地通知** - 应用内的通知提醒（无需配置，开箱即用）
2. **微信订阅消息** - 微信官方推送的订阅消息（需要配置模板ID）

## 本地通知功能

本地通知功能无需任何配置，包括：
- 喂食记录提醒
- 健康检查提醒  
- 清洁记录提醒
- 用药记录提醒
- 繁殖记录提醒

用户可以在设置页面开启/关闭通知功能，查看通知历史，管理未读消息等。

## 微信订阅消息配置

如果需要启用微信订阅消息推送功能，需要进行以下配置：

### 1. 申请订阅消息模板

在微信公众平台（mp.weixin.qq.com）申请以下类型的订阅消息模板：

#### 喂食提醒模板
- 模板用途：提醒用户给鹦鹉喂食
- 建议字段：鹦鹉名称、喂食时间、食物类型

#### 健康检查提醒模板  
- 模板用途：提醒用户进行鹦鹉健康检查
- 建议字段：鹦鹉名称、检查时间、健康状态

#### 清洁提醒模板
- 模板用途：提醒用户清洁鹦鹉笼子
- 建议字段：鹦鹉名称、清洁时间、清洁类型

#### 用药提醒模板
- 模板用途：提醒用户给鹦鹉用药
- 建议字段：鹦鹉名称、用药时间、药物名称

#### 繁殖记录提醒模板
- 模板用途：提醒用户记录鹦鹉繁殖情况
- 建议字段：鹦鹉名称、繁殖时间、繁殖状态

### 2. 配置模板ID

获得模板ID后，在 `miniprogram/utils/template-config.js` 文件中进行配置：

```javascript
const TEMPLATE_CONFIG = {
  // 将下面的示例ID替换为真实的模板ID，并取消注释
  feeding: 'your_real_feeding_template_id',
  health: 'your_real_health_template_id',
  cleaning: 'your_real_cleaning_template_id',
  medication: 'your_real_medication_template_id',
  breeding: 'your_real_breeding_template_id'
}
```

### 3. 后端支持

订阅消息的实际发送需要后端服务器支持。确保后端已实现相应的订阅消息发送接口。

## 错误处理

### 常见错误及解决方案

#### 错误码 20001: "No template data return"
- **原因**：使用了无效的模板ID
- **解决方案**：检查模板ID是否正确，确保在微信公众平台已成功申请

#### 错误码 20003: "Templates count out of max bounds"  
- **原因**：一次申请的模板数量超过限制（最多3个）
- **解决方案**：已自动处理，系统会分批申请权限

#### 错误码 43101: "User refuse to accept the msg"
- **原因**：用户拒绝接收订阅消息
- **解决方案**：引导用户重新授权，或使用本地通知功能

## 测试功能

应用内置了通知功能测试页面，可以通过以下路径访问：
设置 → 通知功能测试

测试页面提供以下功能：
- 测试通知设置的保存和读取
- 测试各类型通知的添加
- 测试通知的标记已读功能
- 测试订阅消息权限申请

## 注意事项

1. 微信订阅消息有使用限制，请合理使用
2. 用户可以随时在微信设置中关闭订阅消息
3. 即使订阅消息功能不可用，本地通知功能仍然正常工作
4. 建议优先配置最重要的3个模板（喂食、健康、清洁）

## 技术支持

如需技术支持或有疑问，请联系开发团队。